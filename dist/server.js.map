{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"express\"","webpack:///external \"axios\"","webpack:///./server/lta/lta.ts","webpack:///./server/lta/bus-stops.ts","webpack:///./server/mongodb-ops.ts","webpack:///./server/server.ts","webpack:///external \"express-session\"","webpack:///external \"path\"","webpack:///external \"cors\"","webpack:///external \"body-parser\"","webpack:///./server/api-router.ts","webpack:///./server/lta/router.ts","webpack:///./server/lta/bus-arrival.ts","webpack:///./server/http-request/router.ts","webpack:///./server/http-request/http-request.ts","webpack:///./server/lunchfun-and-dictionary/router.ts","webpack:///./server/lunchfun-and-dictionary/dictionary.ts","webpack:///./server/lunchfun-and-dictionary/lunchfun-pals.ts","webpack:///external \"mongodb\"","webpack:///./server/lunchfun-and-dictionary/lunchfun-records.ts","webpack:///./server/email/email.ops.ts","webpack:///external \"nodemailer\""],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","busArrivalUrl","busStopsUrl","headerConfig","headers","AccountKey","busStops","getBusStopsFromLta","skip","url","response","status","data","checkBusStopLocally","busStopCode","length","BusStopCode","getAllBusStops","newBusStops","temp","concat","getBusStopInfo","res","send","busStopInfo","getNearbyBusStops","latitude","longitude","undefined","nearbyStops","dLat","Latitude","Math","PI","dLong","Longitude","a","sin","cos","dist","atan2","sqrt","abs","push","ObjectID","database","MONGO_URL","InitDb","MongoClient","connect","useNewUrlParser","client","db","MongoDb","DbCollection","collection","app","express","use","cors","bodyParser","json","urlencoded","extended","session","secret","resave","saveUninitialized","cookie","maxAge","req","sendFile","join","__dirname","static","dotfiles","all","next","listen","console","log","apiRouter","Router","dictionaryRouter","lunchfunRouter","busRouter","post","body","params","query","trim","then","respose","busArrival","catch","e","httpRouter","type","Delete","Get","Post","Put","querys","queryValue","delete","put","word","GetPals","AddPal","DeletePal","GetRecords","AddRecord","payer","attendees","DeleteRecord","_id","GetPalsAttendance","config","app_id","app_key","resp","lemmas","results","forEach","result","lexicalEntries","lexicalEntry","inflectionOf","inflection","message","CheckOxfordLemmas","toLowerCase","entries","return_result","new_lexicalEntry","lexicalCategory","pronunciations","text","entry","senses","sense","definitions","definition","subsenses","subsense","pronunciation","audioFile","phoneticSpelling","lunchPals","refreshPals","find","sort","toArray","insertOne","deleteOne","aggregate","$unwind","$group","attendance","$sum","$project","attendances","qty","createdOn","limit","records","Date","transporter","createTransport","host","secure","auth","user","pass","mailOptions","from","to","subject","html","sendMail"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","module.exports = require(\"express\");","module.exports = require(\"axios\");","const ltaAccountKey = '6sVzf9zXRaCgkJUdjxIw2A==';\r\n\r\nconst busArrivalUrl =\r\n  'http://datamall2.mytransport.sg/ltaodataservice/BusArrivalv2';\r\nconst busStopsUrl = 'http://datamall2.mytransport.sg/ltaodataservice/BusStops';\r\n\r\nconst headerConfig = {\r\n  headers: {\r\n    AccountKey: ltaAccountKey\r\n  }\r\n};\r\n\r\nexport { busArrivalUrl, busStopsUrl, headerConfig };\r\n","import Axios from 'axios';\r\n\r\nimport { Response } from '../interface';\r\nimport { busStopsUrl, headerConfig } from './lta';\r\nimport { BusStopInfo } from './bus-stops-interface';\r\n\r\nlet busStops: BusStopInfo[] = [];\r\n\r\nasync function getBusStopsFromLta(skip?: number): Promise<BusStopInfo[]> {\r\n  try {\r\n    let url = busStopsUrl;\r\n    if (skip) {\r\n      url += `?$skip=${skip}`;\r\n    }\r\n    let response = await Axios.get(url, headerConfig);\r\n    if (response.status != 200) {\r\n      throw { status: response.status };\r\n    }\r\n    return response.data.value;\r\n  } catch (e) {\r\n    throw e;\r\n  }\r\n}\r\n\r\nasync function getAllBusStops() {\r\n  try {\r\n    let skip = 0;\r\n    let newBusStops: BusStopInfo[] = [];\r\n    do {\r\n      newBusStops = await getBusStopsFromLta(skip);\r\n      let temp = busStops;\r\n      busStops = temp.concat(newBusStops);\r\n      skip += 500;\r\n    } while (newBusStops.length === 500);\r\n  } catch (e) {\r\n    busStops = [];\r\n    getAllBusStops();\r\n  }\r\n}\r\ngetAllBusStops();\r\n\r\nfunction checkBusStopLocally(busStopCode: string) {\r\n  if (!busStopCode) {\r\n    return;\r\n  }\r\n  for (let i = 0; i < busStops.length; i++) {\r\n    if (busStopCode === busStops[i].BusStopCode) {\r\n      return busStops[i];\r\n    }\r\n  }\r\n  return;\r\n}\r\n\r\nfunction getBusStopInfo(busStopCode: string, res: Response) {\r\n  if (!busStopCode) {\r\n    return res.status(400).send('Invalid Bus Stop Code.');\r\n  }\r\n  let busStopInfo = checkBusStopLocally(busStopCode);\r\n  if (busStopInfo) {\r\n    return res.status(200).send(busStopInfo);\r\n  }\r\n  return res.status(400).send('Bus Stop Info not found.');\r\n}\r\n\r\nfunction getNearbyBusStops(latitude: number, longitude: number, res: Response) {\r\n  if (latitude === undefined || longitude === undefined) {\r\n    return res.status(400).send('Invalid coordinates.');\r\n  }\r\n\r\n  let nearbyStops = [];\r\n  const R = 6371e3;\r\n  for (let i = 0; i < busStops.length; i++) {\r\n    let dLat = ((busStops[i].Latitude - latitude) * Math.PI) / 180;\r\n    let dLong = ((busStops[i].Longitude - longitude) * Math.PI) / 180;\r\n\r\n    let a =\r\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n      Math.cos((busStops[i].Latitude * Math.PI) / 180) *\r\n        Math.cos((latitude * Math.PI) / 180) *\r\n        Math.sin(dLong / 2) *\r\n        Math.sin(dLong / 2);\r\n    let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    let dist = R * c;\r\n    if (Math.abs(dist) < 280) {\r\n      nearbyStops.push(busStops[i]);\r\n    }\r\n  }\r\n  res.status(200).send(nearbyStops);\r\n}\r\n\r\nexport { busStops, checkBusStopLocally, getBusStopInfo, getNearbyBusStops };\r\n","import { MongoClient, Db, ObjectID } from 'mongodb';\r\n\r\nconst MONGO_URL =\r\n  'mongodb+srv://admin:admin@cluster0-dxwkg.mongodb.net/insg?retryWrites=true';\r\n\r\nlet database: Db;\r\n\r\nasync function InitDb(): Promise<Db> {\r\n  try {\r\n    const client = await MongoClient.connect(MONGO_URL, {\r\n      useNewUrlParser: true\r\n    });\r\n    return (database = client.db('insg'));\r\n  } catch (e) {\r\n    throw 'Database connection failed.';\r\n  }\r\n}\r\n\r\nasync function MongoDb(): Promise<Db> {\r\n  if (database) {\r\n    return database;\r\n  }\r\n\r\n  try {\r\n    await InitDb();\r\n    return database;\r\n  } catch (e) {\r\n    // console.log(e);\r\n    throw e;\r\n  }\r\n}\r\n\r\nasync function DbCollection(name: string) {\r\n  if (database) {\r\n    return database.collection(name);\r\n  }\r\n\r\n  try {\r\n    await InitDb();\r\n    return database.collection(name);\r\n  } catch (e) {\r\n    throw e;\r\n  }\r\n}\r\n\r\nexport { DbCollection, MongoDb, ObjectID };\r\n","import * as express from 'express';\r\nimport * as session from 'express-session';\r\nimport { join } from 'path';\r\nimport * as cors from 'cors';\r\nimport * as bodyParser from 'body-parser';\r\n\r\nimport { Request, Response, NextFunction } from './interface';\r\nimport apiRouter from './api-router';\r\n\r\n// Express server\r\nconst app = express();\r\n\r\napp.use(cors());\r\napp.use(bodyParser.json());\r\napp.use(bodyParser.urlencoded({ extended: false }));\r\n\r\napp.use(\r\n  session({\r\n    secret: 'insg-yc-ly-17',\r\n    resave: false,\r\n    saveUninitialized: true,\r\n    cookie: {\r\n      maxAge: 1000 * 60 * 60 * 24 // millseconds of 24hrs  }\r\n    }\r\n  })\r\n);\r\n\r\napp.use('/api', apiRouter);\r\n\r\napp.get('/', (req: Request, res: Response) => {\r\n  return res.status(200).sendFile(join(__dirname, '/client/index.html'));\r\n});\r\n\r\n// Server static files from /client\r\napp.use(express.static(join(__dirname, '/client')));\r\napp.use(\r\n  express.static(join(__dirname, '/client/assets'), { dotfiles: 'allow' })\r\n);\r\n\r\n// error handling - 1\r\napp.all('/*', (req: Request, res: Response) => {\r\n  return res.status(200).sendFile(join(__dirname, '/client/index.html'));\r\n});\r\n// error handling - 2\r\napp.use((req: Request, res: Response, next: NextFunction) => {\r\n  return res.status(500).send('Issue happened. Please retry later!');\r\n});\r\n\r\napp.listen(8080, () => {\r\n  console.log('app listening on port 8080.');\r\n});\r\n","module.exports = require(\"express-session\");","module.exports = require(\"path\");","module.exports = require(\"cors\");","module.exports = require(\"body-parser\");","import { Router } from 'express';\r\nimport { Request, Response } from './interface';\r\n\r\nimport { busRouter } from './lta/router';\r\nimport httpRouter from './http-request/router';\r\nimport {\r\n  dictionaryRouter,\r\n  lunchfunRouter\r\n} from './lunchfun-and-dictionary/router';\r\nimport giftsRouter from './api-gifts-router';\r\nimport SendEmail from './email/email.ops';\r\n\r\nconst apiRouter = Router();\r\n\r\n// url: /api\r\napiRouter.use('/dictionary', dictionaryRouter);\r\napiRouter.use('/http', httpRouter);\r\napiRouter.use('/lunchfun', lunchfunRouter);\r\napiRouter.use('/lta/bus', busRouter);\r\n// apiRouter.use('/gifts', giftsRouter);\r\n\r\n// msg from users; forward it via nodemailer.\r\napiRouter.post('/msg', (req: Request, res: Response) => {\r\n  SendEmail(req.body, res);\r\n});\r\n\r\n// error handling\r\napiRouter.all('/*', (req: Request, res: Response) => {\r\n  return res.status(400).send('Invalid Request');\r\n});\r\n\r\nexport default apiRouter;\r\n","import { Router } from 'express';\r\n\r\nimport { Request, Response } from '../interface';\r\nimport getBusArrival from './bus-arrival';\r\nimport { getBusStopInfo, getNearbyBusStops } from './bus-stops';\r\n\r\n// url: /api/lta/bus\r\nconst busRouter = Router();\r\n\r\nbusRouter.get('/busArrival/:busStopCode', (req: Request, res: Response) => {\r\n  getBusArrival(req.params.busStopCode, res);\r\n});\r\n\r\nbusRouter.get('/busStop/:busStopCode', (req: Request, res: Response) => {\r\n  getBusStopInfo(req.params.busStopCode, res);\r\n});\r\n\r\nbusRouter.get('/nearbyBusStops', (req: Request, res: Response) => {\r\n  getNearbyBusStops(req.query.latitude, req.query.longitude, res);\r\n});\r\n\r\nexport { busRouter };\r\n","import Axios from 'axios';\r\n\r\nimport { Response } from '../interface';\r\nimport { busArrivalUrl, headerConfig } from './lta';\r\nimport { checkBusStopLocally } from './bus-stops';\r\n\r\nfunction getBusArrival(busStopCode: string, res: Response) {\r\n  busStopCode = busStopCode.trim();\r\n  if (!busStopCode) {\r\n    return res.status(400).send('Invalid BusStopCode.');\r\n  }\r\n\r\n  let busStopInfo = checkBusStopLocally(busStopCode);\r\n  if (!busStopInfo) {\r\n    return res.status(400).send('Bus Stop not found.');\r\n  }\r\n\r\n  let url = `${busArrivalUrl}?BusStopCode=${busStopCode}`;\r\n  Axios.get(url, headerConfig)\r\n    .then(respose => {\r\n      res\r\n        .status(200)\r\n        .send({ busStopInfo: busStopInfo, busArrival: respose.data });\r\n    })\r\n    .catch(e => {\r\n      res.status(400).send(e);\r\n    });\r\n}\r\n\r\nexport default getBusArrival;\r\n","import { Router } from 'express';\r\n\r\nimport { Request, Response } from '../interface';\r\nimport { Delete, Get, Post, Put } from './http-request';\r\n\r\nconst httpRouter = Router();\r\n\r\nhttpRouter.post('', (req: Request, res: Response) => {\r\n  if (req.body.type === 'DELETE') {\r\n    Delete(req.body, res);\r\n  } else if (req.body.type === 'GET') {\r\n    Get(req.body, res);\r\n  } else if (req.body.type === 'POST') {\r\n    Post(req.body, res);\r\n  } else if (req.body.type === 'PUT') {\r\n    Put(req.body, res);\r\n  }\r\n});\r\n\r\nexport default httpRouter;\r\n","import Axios from 'axios';\r\n\r\nimport { Request, Response } from '../interface';\r\n\r\nfunction Delete(body: any, res: Response) {\r\n  let url = body.url;\r\n  if (body.querys && body.querys.length > 0) {\r\n    url += '?';\r\n    for (let i = 0; i < body.querys.length; ++i) {\r\n      url += body.query[i];\r\n      url += '=';\r\n      url += body.queryValue[i];\r\n    }\r\n  }\r\n  Axios.delete(url)\r\n    .then(response => {\r\n      res.status(200).send(response);\r\n    })\r\n    .catch(e => {\r\n      res.status(400).send(e);\r\n    });\r\n}\r\nfunction Post(req: Request, res: Response) {\r\n  let headers = {};\r\n\r\n  return res.status(200).send(req);\r\n  let url: string = req.body.url;\r\n  if (req.body.headers) {\r\n    headers = {\r\n      headers: req.body.headers\r\n    };\r\n  }\r\n  if (req.body.parameters) {\r\n    url += '?';\r\n    for (let i = 0; i < req.body.parameters.length; ++i) {\r\n      url += req.body.parameters[i] + '=' + req.body.parameterValue[i] + '&';\r\n    }\r\n  }\r\n  Axios.get(url, headers).then(response => {\r\n    res.send(response.data);\r\n  });\r\n}\r\nfunction Put(req: Request, res: Response) {\r\n  Axios.put(req.body.url).then(response => {\r\n    res.send(response.data);\r\n  });\r\n}\r\nfunction Get(req: Request, res: Response) {\r\n  Axios.post(req.body.url).then(response => {\r\n    res.send(response.data);\r\n  });\r\n}\r\n\r\nexport { Delete, Get, Post, Put };\r\n","import { Router } from 'express';\r\n\r\nimport { Request, Response } from '../interface';\r\nimport CheckOxfordEntries from './dictionary';\r\nimport { AddPal, DeletePal, GetPals, GetPalsAttendance } from './lunchfun-pals';\r\nimport { AddRecord, DeleteRecord, GetRecords } from './lunchfun-records';\r\n\r\nconst dictionaryRouter = Router();\r\nconst lunchfunRouter = Router();\r\n\r\ndictionaryRouter.get('/oxford/:word', (req: Request, res: Response) => {\r\n  CheckOxfordEntries(req.params.word, res);\r\n});\r\n\r\nlunchfunRouter.get('/pals', (req: Request, res: Response) => {\r\n  GetPals(res);\r\n});\r\nlunchfunRouter.post('/pal', (req: Request, res: Response) => {\r\n  AddPal(req.body.name, res);\r\n});\r\nlunchfunRouter.delete('/pal', (req: Request, res: Response) => {\r\n  DeletePal(req.query, res);\r\n});\r\n\r\nlunchfunRouter.get('/records', (req: Request, res: Response) => {\r\n  GetRecords(res);\r\n});\r\nlunchfunRouter.post('/record', (req: Request, res: Response) => {\r\n  AddRecord(req.body.payer, req.body.attendees, res);\r\n});\r\nlunchfunRouter.delete('/record', (req: Request, res: Response) => {\r\n  DeleteRecord(req.query._id, res);\r\n});\r\n\r\nlunchfunRouter.get('/stats/attendance', (req: Request, res: Response) => {\r\n  GetPalsAttendance(res);\r\n});\r\n\r\nexport { dictionaryRouter, lunchfunRouter };\r\n","import Axios from 'axios';\r\nimport { Response } from '../interface';\r\nimport {\r\n  CheckEntriesResult,\r\n  OxfordEntries,\r\n  OxfordLemmas\r\n} from './oxford-interface';\r\n\r\nconst app_id: string = '0314e9e2';\r\nconst app_key: string = '5a6c2589474a2f83ccd69f397bfec7a2';\r\nconst config = {\r\n  headers: {\r\n    app_id: app_id,\r\n    app_key: app_key\r\n  }\r\n};\r\n\r\nasync function CheckOxfordEntries(word: string, res: Response) {\r\n  if (!word || !word.trim()) {\r\n    return res.status(400).send('Invalid word.');\r\n  }\r\n  word = word.trim().toLowerCase();\r\n\r\n  const url =\r\n    'https://od-api.oxforddictionaries.com/api/v2/entries/en-gb/' +\r\n    word +\r\n    '?fields=definitions%2Cpronunciations';\r\n\r\n  try {\r\n    let resp = await Axios(url, config);\r\n    let entries: OxfordEntries = resp.data;\r\n    let return_result: CheckEntriesResult = { lexicalEntries: [] };\r\n    for (let result of entries.results) {\r\n      for (let lexicalEntry of result.lexicalEntries) {\r\n        let new_lexicalEntry = {\r\n          entries: [],\r\n          lexicalCategory: '',\r\n          pronunciations: []\r\n        };\r\n        return_result.lexicalEntries.push(new_lexicalEntry);\r\n\r\n        if (lexicalEntry.lexicalCategory) {\r\n          new_lexicalEntry.lexicalCategory = lexicalEntry.lexicalCategory.text;\r\n        }\r\n        for (let entry of lexicalEntry.entries) {\r\n          for (let sense of entry.senses) {\r\n            for (let definition of sense.definitions) {\r\n              new_lexicalEntry.entries.push(definition);\r\n            }\r\n\r\n            for (let subsense of sense.subsenses || []) {\r\n              for (let definition of subsense.definitions) {\r\n                new_lexicalEntry.entries.push(definition);\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        for (let pronunciation of lexicalEntry.pronunciations) {\r\n          new_lexicalEntry.pronunciations.push({\r\n            audioFile: pronunciation.audioFile,\r\n            phoneticSpelling: pronunciation.phoneticSpelling\r\n          });\r\n        }\r\n      }\r\n    }\r\n    return res.status(200).send(return_result);\r\n  } catch (e) {\r\n    return res.status(400).send(e.message);\r\n  }\r\n}\r\n\r\nasync function CheckOxfordLemmas(word: string) {\r\n  if (!word || !word.trim()) {\r\n    return 'Invalid word.';\r\n  }\r\n  const url =\r\n    'https://od-api.oxforddictionaries.com/api/v2/lemmas/en-gb/' + word;\r\n\r\n  try {\r\n    let resp = await Axios(url, config);\r\n    const lemmas: OxfordLemmas = resp.data;\r\n    let return_result = [];\r\n    lemmas.results.forEach(result => {\r\n      result.lexicalEntries.forEach(lexicalEntry => {\r\n        lexicalEntry.inflectionOf.forEach(inflection => {\r\n          return_result.push(inflection);\r\n        });\r\n      });\r\n    });\r\n    return return_result;\r\n  } catch (e) {\r\n    return e.message;\r\n  }\r\n}\r\n\r\n\r\nCheckOxfordLemmas('shops');\r\n\r\nexport default CheckOxfordEntries;\r\n","import { Response } from '../interface';\r\nimport { DbCollection } from '../mongodb-ops';\r\n\r\nlet lunchPals = [];\r\n\r\nasync function refreshPals() {\r\n  try {\r\n    const palsCollection = await DbCollection('lunchfun-pals');\r\n    lunchPals = await palsCollection\r\n      .find()\r\n      .sort({ name: 1 })\r\n      .toArray();\r\n  } catch (e) {\r\n    throw e;\r\n  }\r\n}\r\n\r\nasync function GetPals(res: Response) {\r\n  if (lunchPals.length > 0) {\r\n    return res.status(200).send(lunchPals);\r\n  }\r\n\r\n  try {\r\n    await refreshPals();\r\n    return res.status(200).send(lunchPals);\r\n  } catch (e) {\r\n    return res.status(500).send(e);\r\n  }\r\n}\r\n\r\nasync function AddPal(name: string, res: Response) {\r\n  if (!name) {\r\n    return res.status(400).send('Invalid input.');\r\n  }\r\n\r\n  try {\r\n    const palsCollection = await DbCollection('lunchfun-pals');\r\n    palsCollection.insertOne({ name: name });\r\n    refreshPals();\r\n    return res.status(200).send({ result: 'ok' });\r\n  } catch (e) {\r\n    return res.status(500).send(e);\r\n  }\r\n}\r\n\r\nasync function DeletePal(name: string, res: Response) {\r\n  if (!name) {\r\n    return res.status(400).send('Invalid name to delete.');\r\n  }\r\n\r\n  try {\r\n    const palsCollection = await DbCollection('lunchfun-pals');\r\n    palsCollection.deleteOne({ name: name });\r\n    refreshPals();\r\n    return res.status(200).send({ result: 'ok' });\r\n  } catch (e) {\r\n    return res.status(500).send(e);\r\n  }\r\n}\r\n\r\nasync function GetPalsAttendance(res: Response) {\r\n  try {\r\n    const collection = await DbCollection('lunchfun-records');\r\n    const attendances = await collection\r\n      .aggregate([\r\n        { $unwind: '$attendees' },\r\n        { $group: { _id: '$attendees', attendance: { $sum: 1 } } },\r\n        { $project: { name: '$_id', attendance: '$attendance' } }\r\n      ])\r\n      .toArray();\r\n    return res.status(200).send(attendances);\r\n  } catch (e) {\r\n    return res.status(500).send(e);\r\n  }\r\n}\r\n\r\nexport { AddPal, DeletePal, GetPals, GetPalsAttendance };\r\n","module.exports = require(\"mongodb\");","import { Response } from '../interface';\r\nimport { DbCollection, ObjectID } from '../mongodb-ops';\r\n\r\nasync function GetRecords(res: Response, qty?: number) {\r\n  try {\r\n    const collection = await DbCollection('lunchfun-records');\r\n    const records = await collection\r\n      .find({})\r\n      .sort({ createdOn: -1 })\r\n      .limit(qty | 30)\r\n      .toArray();\r\n    return res.status(200).send(records);\r\n  } catch (e) {\r\n    return res.status(500).send(e);\r\n  }\r\n}\r\n\r\nasync function AddRecord(payer: string, attendees: string[], res: Response) {\r\n  if (!payer || !attendees || attendees.length <= 0) {\r\n    return res.status(400).send('Invalid params to add.');\r\n  }\r\n\r\n  try {\r\n    const collection = await DbCollection('lunchfun-records');\r\n    await collection.insertOne({\r\n      payer: payer,\r\n      attendees: attendees,\r\n      createdOn: new Date()\r\n    });\r\n    return res.status(200).send({ result: 'ok' });\r\n  } catch (e) {\r\n    // console.log(e);\r\n    return res.status(500).send('Error at server. Please try again later.');\r\n  }\r\n}\r\n\r\nasync function DeleteRecord(_id: string, res: Response) {\r\n  if (!_id) {\r\n    return res.status(400).send('Invalid record to delete.');\r\n  }\r\n\r\n  try {\r\n    const collection = await DbCollection('lunchfun-records');\r\n    collection.deleteOne({ _id: new ObjectID(_id) });\r\n    return res.status(200).send({ result: 'ok' });\r\n  } catch (e) {\r\n    return res.status(500).send(e);\r\n  }\r\n}\r\n\r\nexport { AddRecord, DeleteRecord, GetRecords };\r\n","import { createTransport } from 'nodemailer';\r\n\r\nimport { Response } from '../interface';\r\n\r\nconst transporter = createTransport({\r\n  host: 'mail.insg.xyz',\r\n  secure: true,\r\n  auth: {\r\n    user: 'i@insg.xyz',\r\n    pass: 'pass1234'\r\n  }\r\n});\r\n\r\nconst mailOptions = {\r\n  from: 'i@insg.xyz',\r\n  to: 'seesea2@gmail.com',\r\n  subject: 'Hello',\r\n  text: 'This is email from InSG.xyz',\r\n  html: '<b>this is email from InSG.xyz</b>'\r\n};\r\n\r\nfunction SendEmail(body: any, res: Response) {\r\n  // const emailHtml: string =\r\n  //   '<!DOCTYPE html><head>' +\r\n  //   '<meta http-equiv=\"content-type\" content=\"text/html;charset=UTF-8\"></head>' +\r\n  //   `<body><br><b>Message from User ${body.name}` +\r\n  //   ' :</b><br><br>' +\r\n  //   `<p><b>Email: </b> ${body.email}` +\r\n  //   '</p>' +\r\n  //   `<p><b>Mobile: </b> ${body.mobile}` +\r\n  //   '</p>' +\r\n  //   `<p><b>Message: </b> ${body.message}` +\r\n  //   '</p>' +\r\n  //   '</body></html>';\r\n\r\n  // mailOptions.subject = 'User Inquiry';\r\n  // mailOptions.html = emailHtml;\r\n  transporter.sendMail(mailOptions);\r\n  // return res.status(200).send({ result: 'ok' });\r\n}\r\n\r\nexport default SendEmail;\r\n","module.exports = require(\"nodemailer\");"],"sourceRoot":""}