!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t){e.exports=require("express")},function(e,t){e.exports=require("axios")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{a(r.next(e))}catch(e){u(e)}}function i(e){try{a(r.throw(e))}catch(e){u(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(4),o=n(23),i=u.join(__dirname,"/../info.xyz"),a=o.verbose(),c=void 0,l=void 0;t.SqliteGet=function(e){var t=this;return new Promise((function(n,u){return r(t,void 0,void 0,(function(){return s(this,(function(t){try{c||(c=new a.Database(i,o.OPEN_READONLY)),c.get(e,(function(e,t){if(e)return u(e);n(t)}))}catch(e){u(e)}return[2]}))}))}))},t.SqliteAll=function(e){var t=this;return new Promise((function(n,u){return r(t,void 0,void 0,(function(){return s(this,(function(t){try{c||(c=new a.Database(i,o.OPEN_READONLY)),c.all(e,(function(e,t){if(e)return u(e);n(t)}))}catch(e){u(e)}return[2]}))}))}))},t.SqliteRun=function(e){var t=this;return new Promise((function(n,u){return r(t,void 0,void 0,(function(){return s(this,(function(t){try{l||(l=new a.Database(i,o.OPEN_READWRITE)),l.run(e,[],(function(e){if(e)return u(e);n(!0)}))}catch(e){u(e)}return[2]}))}))}))},t.SqlitePrepareRun=function(e,t){var n=this;return new Promise((function(u,c){return r(n,void 0,void 0,(function(){return s(this,(function(n){try{l||(l=new a.Database(i,o.OPEN_READWRITE)),l.serialize((function(){for(var n=l.prepare(e,(function(e){if(e)return c(e)})),r=0;r<t.length;r++)n.run(t[r]);n.finalize((function(e){if(e)return c(e);u(!0)}))}))}catch(e){c(e)}return[2]}))}))}))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{a(r.next(e))}catch(e){u(e)}}function i(e){try{a(r.throw(e))}catch(e){u(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(25);t.ObjectID=u.ObjectID;var o,i="mongodb+srv://admin:admin@cluster0-dxwkg.mongodb.net/insg?retryWrites=true";function a(){return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,u.MongoClient.connect(i,{useNewUrlParser:!0})];case 1:return e=t.sent(),[2,o=e.db("insg")];case 2:throw t.sent(),"Database connection failed.";case 3:return[2]}}))}))}t.MongoDb=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:if(o)return[2,o];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,a()];case 2:return e.sent(),[2,o];case 3:throw e.sent();case 4:return[2]}}))}))},t.DbCollection=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:if(o)return[2,o.collection(e)];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,a()];case 2:return t.sent(),[2,o.collection(e)];case 3:throw t.sent();case 4:return[2]}}))}))}},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.busArrivalUrl="http://datamall2.mytransport.sg/ltaodataservice/BusArrivalv2";t.busStopsUrl="http://datamall2.mytransport.sg/ltaodataservice/BusStops";var r={headers:{AccountKey:"6sVzf9zXRaCgkJUdjxIw2A=="}};t.headerConfig=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{a(r.next(e))}catch(e){u(e)}}function i(e){try{a(r.throw(e))}catch(e){u(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),o=n(5),i=[];function a(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=o.busStopsUrl,e&&(t+="?$skip="+e),[4,u.default.get(t,o.headerConfig)];case 1:if(200!=(n=r.sent()).status)throw{status:n.status};return[2,n.data.value];case 2:throw r.sent();case 3:return[2]}}))}))}function c(e){if(e)for(var t=0;t<i.length;t++)if(e===i[t].BusStopCode)return i[t]}t.busStops=i,function e(){return r(this,void 0,void 0,(function(){var n,r,u;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,,6]),n=0,r=[],s.label=1;case 1:return[4,a(n)];case 2:r=s.sent(),u=i,t.busStops=i=u.concat(r),n+=500,s.label=3;case 3:if(500===r.length)return[3,1];s.label=4;case 4:return[3,6];case 5:return s.sent(),t.busStops=i=[],e(),[3,6];case 6:return[2]}}))}))}(),t.checkBusStopLocally=c,t.getBusStopInfo=function(e,t){if(!e)return t.status(400).send("Invalid Bus Stop Code.");var n=c(e);return n?t.status(200).send(n):t.status(400).send("Bus Stop Info not found.")},t.getNearbyBusStops=function(e,t,n){if(void 0===e||void 0===t)return n.status(400).send("Invalid coordinates.");for(var r=[],s=0;s<i.length;s++){var u=(i[s].Latitude-e)*Math.PI/180,o=(i[s].Longitude-t)*Math.PI/180,a=Math.sin(u/2)*Math.sin(u/2)+Math.cos(i[s].Latitude*Math.PI/180)*Math.cos(e*Math.PI/180)*Math.sin(o/2)*Math.sin(o/2),c=6371e3*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)));Math.abs(c)<280&&r.push(i[s])}n.status(200).send(r)}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{a(r.next(e))}catch(e){u(e)}}function i(e){try{a(r.throw(e))}catch(e){u(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(3);t.GetInventory=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,u.DbCollection("gifts-inventory")];case 1:return[4,r.sent().find().toArray()];case 2:return t=r.sent(),[2,e.status(200).send(t)];case 3:return n=r.sent(),[2,e.status(500).send(n.message)];case 4:return[2]}}))}))},t.AdjustInventory=function(e,t,n){return r(this,void 0,void 0,(function(){var r,o;return s(this,(function(s){switch(s.label){case 0:if(!e||!t)return[2,n.status(400).send("Invalid input.")];s.label=1;case 1:return s.trys.push([1,4,,5]),[4,u.DbCollection("gifts-inventory")];case 2:return[4,s.sent().updateOne({_id:new u.ObjectID(e)},{$set:{modifiedOn:new Date,qty:t}},{upsert:!0})];case 3:return r=s.sent(),[2,n.status(200).send(r)];case 4:return o=s.sent(),[2,n.status(500).send(o)];case 5:return[2]}}))}))},t.ReserveInventory=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o,i;return s(this,(function(s){switch(s.label){case 0:if(!t||t.length<=0)throw"The cart is empty.";s.label=1;case 1:return s.trys.push([1,7,,8]),n=[],r=[],[4,u.DbCollection("gifts-inventory")];case 2:o=s.sent(),i=0,s.label=3;case 3:return i<t.length?[4,o.updateOne({_id:new u.ObjectID(t[i].product._id),qty:{$gte:t[i].qty}},{$inc:{qty:-t[i].qty},$push:{reservations:{qty:t[i].qty,_id:new u.ObjectID(e),createdOn:new Date}}})]:[3,6];case 4:if(0===s.sent().result.nModified)return r.push(t[i].product),[3,6];n.push(t[i].product),s.label=5;case 5:return i++,[3,3];case 6:if(r.length>0){for(i=0;i<n.length;i++)o.updateOne({_id:n[i]._id,"reservations._id":e},{$inc:{qty:n[i].qty},$pull:{reservations:{_id:e}}});throw"Not enough storage."}return[2,"Success."];case 7:throw s.sent();case 8:return[2]}}))}))},t.DeleteInventoryReservation=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,u.DbCollection("gifts-inventory")];case 1:return[4,r.sent().updateOne({"reservations._id":new u.ObjectID(e)},{$pull:{reservations:{_id:new u.ObjectID(e)}}})];case 2:if((t=r.sent()).result.nModified<=0)throw"delete reservation failed.";return[2,t];case 3:throw n=r.sent(),console.log(n),"delete reservation failed with exception.";case 4:return[2]}}))}))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{a(r.next(e))}catch(e){u(e)}}function i(e){try{a(r.throw(e))}catch(e){u(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(2),o=n(9);function i(e){if(e){if(e.staff)return!0;if(e.user)return!0}return!1}t.Login=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,a,c;return s(this,(function(s){switch(s.label){case 0:if(e.session&&e.session.staff)return[2,t.status(200).send({uid:e.session.staff.uid,bStaff:!0})];if(e.session&&e.session.user)return[2,t.status(200).send({uid:e.session.user.uid})];s.label=1;case 1:return s.trys.push([1,4,,5]),n=(e.body.uid||"").trim(),r=o.encrypt(e.body.pwd),n&&r?(i=e.session,[4,u.SqliteGet('select * from giftsStaffs where uid="'+n+'" and pwd="'+r+'"')]):[2,t.status(400).send({result:"username and password required."})];case 2:return i.staff=s.sent(),e.session.staff?[2,t.status(200).send({uid:e.session.staff.uid,bStaff:!0})]:(a=e.session,[4,u.SqliteGet('select * from giftsUsers where uid="'+n+'" and pwd="'+r+'"')]);case 3:return a.user=s.sent(),e.session.user?[2,t.status(200).send({uid:e.session.user.uid})]:[2,t.status(403).send("Incorrect username or password")];case 4:return c=s.sent(),console.log(c),[2,t.status(500).send("server error.")];case 5:return[2]}}))}))},t.Logout=function(e,t){return e.session&&e.session.staff&&(e.session.staff=null),e.session&&e.session.user&&(e.session.user=null),t.status(200).send({result:"ok"})},t.Register=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(!e.email||!e.pwd)return[2,t.status(400).send("Invalid input.")];r.label=1;case 1:return r.trys.push([1,3,,4]),"email,pwd,createdOn",n='"'+e.email+'","'+o.encrypt(e.pwd)+'",'+Date.now(),[4,u.SqliteRun("insert into giftsUsers (email,pwd,createdOn) values ("+n+")")];case 2:return r.sent()?[2,t.status(200).send({result:"ok"})]:[2,t.status(500).send("Register failed. Please try again later.")];case 3:return r.sent(),[2,t.status(500).send("Register failed. Please try again later.")];case 4:return[2]}}))}))},t.DeleteUser=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(n){if(!e||!e.user)return[2,t.status(403).send("Login is required.")];try{return u.SqliteRun('delete from giftsUsers where uid="'+e.user.uid+'"'),e.user=null,[2,t.status(200).send({result:"User deleted."})]}catch(e){return[2,t.status(400).send(e)]}return[2]}))}))},t.UserInfo=function(e,t){return i(e)?t.status(200).send({uid:e.user.uid,email:e.user.email}):t.status(403).send("User not login.")},t.bLogin=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(28),s="aes-192-cbc",u=r.scryptSync("inSGyc83","salt",24),o=Buffer.alloc(16,0);t.encrypt=function(e){try{var t=r.createCipheriv(s,u,o),n=t.update(e,"utf8","hex");return n+=t.final("hex")}catch(e){}},t.decrypt=function(e){try{var t=r.createDecipheriv(s,u,o),n=t.update(e,"hex","utf8");return n+=t.final("utf8")}catch(e){}}},function(e,t,n){"use strict";var r;function s(e,t){var n="";switch(e){case r.String:n="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";break;case r.Number:n="0123456789";break;case r.Capital:n="ABCDEFGHIJKLMNOPQRSTUVWXYZ";break;default:return""}for(var s="",u=t;u>0;--u)s+=n[Math.floor(Math.random()*n.length)];return s}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Capital=0]="Capital",e[e.Number=1]="Number",e[e.String=2]="String"}(r||(r={})),t.randomNumber=function(e){return s(r.Number,e)},t.randomCapitals=function(e){return s(r.Capital,e)},t.randomString=function(e){return s(r.String,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(12),u=n(4),o=n(13),i=n(14),a=n(15),c=n(10),l=r();l.use(o()),l.use(i.json()),l.use(i.urlencoded({extended:!1})),l.use(s({secret:c.randomString(20),resave:!1,saveUninitialized:!0,cookie:{maxAge:864e5}})),l.use("/api",a.default),l.get("/",(function(e,t){return t.status(200).sendFile(u.join(__dirname,"/client/index.html"))})),l.use(r.static(u.join(__dirname,"/client"))),l.use(r.static(u.join(__dirname,"/client/assets"),{dotfiles:"allow"})),l.all("/*",(function(e,t){return t.status(200).sendFile(u.join(__dirname,"/client/index.html"))})),l.use((function(e,t,n){return t.status(500).send("Issue happened. Please retry later!")})),l.listen(8080,(function(){console.log("App listening on port 8080.")}))},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("body-parser")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(16),u=n(18),o=n(20),i=n(33),a=n(35),c=r.Router();c.use("/lta/bus",s.busRouter),c.use("/dictionary",u.default),c.use("/gifts",o.default),c.use("/http",i.default),c.post("/msg",(function(e,t){a.default(e.body,t)})),c.all("/*",(function(e,t){return t.status(400).send("Invalid Request")})),t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(17),u=n(6),o=r.Router();t.busRouter=o,o.get("/busArrival/:busStopCode",(function(e,t){s.default(e.params.busStopCode,t)})),o.get("/busStop/:busStopCode",(function(e,t){u.getBusStopInfo(e.params.busStopCode,t)})),o.get("/nearbyBusStops",(function(e,t){u.getNearbyBusStops(e.query.latitude,e.query.longitude,t)}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=n(5),u=n(6);t.default=function(e,t){if(!(e=e.trim()))return t.status(400).send("Invalid BusStopCode.");var n=u.checkBusStopLocally(e);if(!n)return t.status(400).send("Bus Stop not found.");var o=s.busArrivalUrl+"?BusStopCode="+e;r.default.get(o,s.headerConfig).then((function(e){t.status(200).send({busStopInfo:n,busArrival:e.data})})).catch((function(e){t.status(400).send(e)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(19),u=r.Router();u.get("/oxford/:word",(function(e,t){s.default(e.params.word,t)})),t.default=u},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{a(r.next(e))}catch(e){u(e)}}function i(e){try{a(r.throw(e))}catch(e){u(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),o={headers:{app_id:"0314e9e2",app_key:"5a6c2589474a2f83ccd69f397bfec7a2"}};t.default=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,a,c,l,f,d,p,h,y,b,v,g,w,m,_,S,x,P,O,k,I,C,q,D,j,M,R;return s(this,(function(s){switch(s.label){case 0:if(!e||!e.trim())return[2,t.status(400).send("Invalid word.")];e=e.trim().toLowerCase(),n="https://od-api.oxforddictionaries.com/api/v2/entries/en-gb/"+e+"?fields=definitions%2Cpronunciations",s.label=1;case 1:return s.trys.push([1,3,,4]),[4,u.default(n,o)];case 2:for(r=s.sent(),i=r.data,a={lexicalEntries:[]},c=0,l=i.results;c<l.length;c++)for(f=l[c],d=0,p=f.lexicalEntries;d<p.length;d++){for(h=p[d],y={entries:[],lexicalCategory:"",pronunciations:[]},a.lexicalEntries.push(y),h.lexicalCategory&&(y.lexicalCategory=h.lexicalCategory.text),b=0,v=h.entries;b<v.length;b++)for(g=v[b],w=0,m=g.senses;w<m.length;w++){for(_=m[w],S=0,x=_.definitions||[];S<x.length;S++)q=x[S],y.entries.push(q);for(P=0,O=_.subsenses||[];P<O.length;P++)for(k=O[P],I=0,C=k.definitions;I<C.length;I++)q=C[I],y.entries.push(q)}for(D=0,j=h.pronunciations;D<j.length;D++)M=j[D],y.pronunciations.push({audioFile:M.audioFile,phoneticSpelling:M.phoneticSpelling})}return[2,t.status(200).send(a)];case 3:return R=s.sent(),[2,t.status(400).send(R.message)];case 4:return[2]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(21),u=n(26),o=n(27),i=n(31),a=r.Router();a.use("/products",s.default),a.use("/orders",u.default),a.use("/users",o.default),a.use("/staffs",i.default),t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(22),u=n(24),o=n(7),i=r.Router();i.get("/view/:product_no",(function(e,t){u.GetProduct(e.params,t)})),i.get("/categories",(function(e,t){s.GetCategories(t)})),i.post("/category",(function(e,t){s.AddCategory(e.body,t)})),i.put("/category",(function(e,t){s.UpdateCategory(e.body,t)})),i.delete("/category",(function(e,t){s.DeleteCategory(e.query,t)})),i.get("/samples",(function(e,t){s.GetSamplesOfCategories(t)})),i.get("",(function(e,t){u.GetProducts(null,t)})),i.get("/product",(function(e,t){u.GetProduct(e.query,t)})),i.post("/product",(function(e,t){u.AddProduct(e.body,t)})),i.put("/product",(function(e,t){u.UpdateProduct(e.body,t)})),i.delete("/product",(function(e,t){u.DeleteProduct(e.query,t)})),i.get("/inventory",(function(e,t){o.GetInventory(t)})),i.put("/inventory",(function(e,t){o.AdjustInventory(e.body._id,e.body.qty,t)})),t.default=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{a(r.next(e))}catch(e){u(e)}}function i(e){try{a(r.throw(e))}catch(e){u(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(2),o=[],i=[];t.GetCategories=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:if(o.length>0)return[2,e.status(200).send(o)];n.label=1;case 1:return n.trys.push([1,3,,4]),"select * from giftsProductsCategories;",[4,u.SqliteAll("select * from giftsProductsCategories;")];case 2:return o=n.sent(),[2,e.status(200).send(o)];case 3:return t=n.sent(),[2,e.status(500).send(t)];case 4:return[2]}}))}))},t.GetSamplesOfCategories=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:if(i.length>0)return[2,e.status(200).send(i)];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,u.SqliteAll("")];case 2:return i=n.sent(),[2,e.status(200).send(i)];case 3:return t=n.sent(),[2,e.status(500).send(t)];case 4:return[2]}}))}))},t.AddCategory=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a;return s(this,(function(s){switch(s.label){case 0:if(!e.name)return[2,t.status(400).send("Invalid input.")];s.label=1;case 1:return s.trys.push([1,3,,4]),"name,parent,category",n='"'+e.name+'"',e.parent?(n+=',"'+e.parent+'"',n+=',"'+e.parent+"/"+e.name+'"'):(n+=',""',n+=',"/'+e.name+'"'),r="insert into giftsProductsCategories (name,parent,category) values ("+n+")",[4,u.SqliteRun(r)];case 2:return s.sent()?(o=[],i=[],[2,t.status(200).send({result:"ok"})]):[2,t.status(200).send({result:"failed"})];case 3:return a=s.sent(),[2,t.status(500).send(a)];case 4:return[2]}}))}))},t.DeleteCategory=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return s(this,(function(s){switch(s.label){case 0:if(!e.category)return[2,t.status(400).send("Invalid input.")];s.label=1;case 1:return s.trys.push([1,3,,4]),n="delete from giftsProductsCategories where category='"+e.category+"';",[4,u.SqliteRun(n)];case 2:return s.sent()?(o=[],i=[],[2,t.status(200).send({result:"ok"})]):[2,t.status(500).send({result:"failed"})];case 3:return r=s.sent(),[2,t.status(500).send(r)];case 4:return[2]}}))}))},t.UpdateCategory=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,c;return s(this,(function(s){switch(s.label){case 0:if(!e.org||!e.newName)return[2,t.status(400).send("Invalid input.")];s.label=1;case 1:return s.trys.push([1,4,,5]),n="select * from giftsProductsCategories where parent='"+e.org.category+"';",[4,u.SqliteAll(n)];case 2:return(r=s.sent())&&r.forEach((function(e){})),a="update giftsProductsCategories set name='"+e.newName+"',category='"+(e.org.parent||"")+"/"+e.newName+"' where category='"+e.org.category+"';",[4,u.SqliteRun(a)];case 3:return s.sent()?(o=[],i=[],[2,t.status(200).send({result:"ok"})]):[2,t.status(500).send({result:"failed"})];case 4:return c=s.sent(),[2,t.status(500).send(c)];case 5:return[2]}}))}))},function(e){r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:if(!(o.length<=0))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,u.SqliteAll("select * from giftsProductsCategories;")];case 2:return o=n.sent(),[3,4];case 3:throw n.sent();case 4:return e?(t=[],o.forEach((function(n){console.log(n.category.match(new RegExp("/","g"))),n.category.match(new RegExp("/","g")).length<=e&&t.push(n)})),[2,t]):[2,o]}}))}))}(0)},function(e,t){e.exports=require("sqlite3")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{a(r.next(e))}catch(e){u(e)}}function i(e){try{a(r.throw(e))}catch(e){u(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(2);t.GetProduct=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o;return s(this,(function(s){switch(s.label){case 0:if(!e.id)return[2,t.status(400).send("Invalid product no.")];s.label=1;case 1:return s.trys.push([1,3,,4]),n="select * from giftsProducts where id="+e.id+";",[4,u.SqliteGet(n)];case 2:return r=s.sent(),[2,t.status(200).send(r)];case 3:return o=s.sent(),[2,t.status(500).send(o)];case 4:return[2]}}))}))},t.GetProducts=function(e,t){return r(this,void 0,void 0,(function(){var e,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),"select * from giftsProducts where (inactive is null or inactive<>1) limit 50;",[4,u.SqliteAll("select * from giftsProducts where (inactive is null or inactive<>1) limit 50;")];case 1:return e=r.sent(),[2,t.status(200).send(e)];case 2:return n=r.sent(),[2,t.status(500).send(n)];case 3:return[2]}}))}))},t.GetProductsByCategory=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o,i,a,c;return s(this,(function(s){switch(s.label){case 0:if(!e.category)return[2,t.status(400).send({result:"Invalid category."})];s.label=1;case 1:return s.trys.push([1,3,,4]),n=e.category.lastIndexOf("/"),r=e.category.substring(n+1,e.category.lenght),o=null,0!==n&&(o=e.category.substring(0,n)),i="select * from giftsProducts where name='"+r+"' and parent='"+o+"'",[4,u.SqliteAll(i)];case 2:return a=s.sent(),[2,t.status(200).send(a)];case 3:return c=s.sent(),[2,t.status(500).send(c)];case 4:return[2]}}))}))},t.AddProduct=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o;return s(this,(function(s){switch(s.label){case 0:if(!e.name)return[2,t.status(400).send("Invalid name.")];s.label=1;case 1:return s.trys.push([1,3,,4]),"",n="","name",n='"'+e.name+'"',console.log(typeof e.price),(e.price||0)<=0&&(e.price=0),",price",n+=","+e.price,(e.qty||0)<=0&&(e.qty=0),",qty",n+=","+e.qty,e.colour||(e.colour=""),",colour",n+=',"'+e.colour+'"',e.category||(e.category=""),",category",n+=',"'+e.category+'"',e.img||(e.img=""),",img",n+=',"'+e.img+'"',e.packaging||(e.packaging=""),",packaging",n+=',"'+e.packaging+'"',e.note||(e.note=""),",note",n+=',"'+e.note+'"',e.material||(e.material=""),",material",n+=',"'+e.material+'"',e.retailer||(e.retailer=""),",retailer",n+=',"'+e.retailer+'"',",createdOn",n+=","+Date.now(),r="insert into giftsProducts (name,price,qty,colour,category,img,packaging,note,material,retailer,createdOn) values ("+n+");",[4,u.SqliteRun(r)];case 2:return s.sent()?[2,t.status(200).send({result:"ok"})]:[2,t.status(500).send({result:"failed"})];case 3:return o=s.sent(),console.log(o),[2,t.status(500).send(o)];case 4:return[2]}}))}))},t.UpdateProduct=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o;return s(this,(function(s){switch(s.label){case 0:if(!e.id)return[2,t.status(400).send("Invalid input.")];s.label=1;case 1:return s.trys.push([1,3,,4]),n="name='"+e.name+"'",e.img&&(n+=",img='"+e.img+"'"),e.price&&(n+=",price="+e.price),e.category&&(n+=",category='"+e.category+"'"),e.colour&&(n+=",colour='"+e.colour+"'"),e.packaging&&(n+=",packaging='"+e.packaging+"'"),e.material&&(n+=",material='"+e.material+"'"),e.size&&(n+=",size='"+e.size+"'"),e.note&&(n+=",note='"+e.note+"'"),e.retailer&&(n+=",retailer='"+e.retailer+"'"),n+=",modifiedOn='"+Date.now()+"'",r="update giftsProducts set "+n+" where id="+e.id,[4,u.SqliteRun(r)];case 2:return s.sent()?[2,t.status(200).send({result:"ok"})]:[2,t.status(500).send({result:"failed"})];case 3:return o=s.sent(),[2,t.status(500).send(o)];case 4:return[2]}}))}))},t.DeleteProduct=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return s(this,(function(s){switch(s.label){case 0:if(!e.id)return[2,t.status(400).send("Invalid product id.")];s.label=1;case 1:return s.trys.push([1,3,,4]),n="update giftsProducts set inactive=1 where id="+e.id+";",[4,u.SqliteRun(n)];case 2:return s.sent()?[2,t.status(200).send({result:"ok"})]:[2,t.status(500).send({result:"failed"})];case 3:return r=s.sent(),[2,t.status(500).send(r)];case 4:return[2]}}))}))}},function(e,t){e.exports=require("mongodb")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0).Router();r.get("/allOrders",(function(e,t){return e.session&&e.session.staff?t.status(200).send({result:"ok"}):t.sendStatus(401)})),r.put("/updateStatus",(function(e,t){if(!e.session||!e.session.staff.id)return t.sendStatus(401);if(!e.body.new_status||!e.body.sno||!e.body.order_no)return t.status(400).send("Failed. Pleaes review inputs.");e.body.order_no,e.body.sno,Date.now(),e.session.staff.id,e.body.new_status,e.body.note;return t.status(200).send({result:"ok"})})),r.put("/updateContact",(function(e,t){if(!e.session||!e.session.staff.id)return t.sendStatus(401);if(!e.body.order_no)return t.status(400).send("Order_no empty.");if(!(e.body.email&&e.body.email.includes("@")&&e.body.email.includes("."))||e.body.email.includes("/")||e.body.email.includes("\\"))return t.status(400).send("Invalid email.");if(!e.body.name)return t.status(400).send("Invalid name.");e.body.name,e.body.email,e.body.mobile,e.body.company,e.body.mobile2,e.body.addr,e.body.order_no;return t.status(200).send({result:"ok"})})),r.put("/updateOrderItem",(function(e,t){if(!e.session||!e.session.staff.id)return t.sendStatus(401);if(!e.body.order_no)return t.status(400).send("Failed. Invalid Order No.");if(!e.body.sno||""===e.body.sno)return t.status(400).send("Failed. Invalid Order Sno.");e.body.new_sale_price,e.body.new_qty,e.body.new_status,e.body.order_no,e.body.sno;return t.status(200).send({result:"ok"})})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(8),u=n(29),o=r.Router();o.post("/login",(function(e,t){s.Login(e,t)})),o.get("/info",(function(e,t){s.UserInfo(e.session,t)})),o.get("/logout",(function(e,t){s.Logout(e,t)})),o.post("/register",(function(e,t){s.Register(e.body,t)})),o.delete("/deleteuser",(function(e,t){s.DeleteUser(e.session,t)})),o.get("/cart",(function(e,t){u.GetCart(e.session,t)})),o.post("/cart",(function(e,t){u.AddToCart(e.session,e.body,t)})),o.delete("/cart",(function(e,t){u.DeleteCart(e.session,t)})),o.put("/cart",(function(e,t){u.UpdateCartQty(e,t)})),o.delete("/cart/product",(function(e,t){u.DeleteInCart(e.session,e.query._id,t)})),o.post("/cart/checkout",(function(e,t){u.CartCheckout(e,t)})),t.default=o},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{a(r.next(e))}catch(e){u(e)}}function i(e){try{a(r.throw(e))}catch(e){u(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(3),o=n(10),i=n(8),a=n(7),c=n(30);t.GetCart=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return s(this,(function(s){switch(s.label){case 0:if(!i.bLogin(e))return[2,t.status(403).send("User not login")];s.label=1;case 1:return s.trys.push([1,4,,5]),[4,u.DbCollection("gifts-carts")];case 2:return[4,s.sent().findOne({_id:new u.ObjectID(e.user._id)})];case 3:return n=s.sent(),console.log(n),[2,t.status(200).send(n)];case 4:return r=s.sent(),[2,t.status(500).send(r)];case 5:return[2]}}))}))},t.AddToCart=function(e,t,n){return r(this,void 0,void 0,(function(){var r,o;return s(this,(function(s){switch(s.label){case 0:if(!i.bLogin(e))return[2,n.status(403).send("User not login")];s.label=1;case 1:return s.trys.push([1,5,,6]),[4,u.DbCollection("gifts-carts")];case 2:return[4,(r=s.sent()).updateOne({_id:new u.ObjectID(e.user._id)},{$pull:{products:{productId:new u.ObjectID(t.product._id)}}})];case 3:return s.sent(),[4,r.updateOne({_id:new u.ObjectID(e.user._id)},{$push:{products:{productId:new u.ObjectID(t.product._id),quantity:t.qty,name:t.product.name,price:t.product.price}}},{upsert:!0})];case 4:return s.sent(),[2,n.status(200).send({result:"ok"})];case 5:return o=s.sent(),[2,n.status(500).send(o)];case 6:return[2]}}))}))},t.UpdateCartQty=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(i.bLogin(e.session)||t.status(403).send("User not login."),!e.body.productId||!e.body.qty)return[2,t.status(400).send("Invalid input.")];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,u.MongoDb()];case 2:return[4,r.sent().collection("gifts-carts").updateOne({_id:e.session.user._id,"products.productId":e.body.productId},{$set:{"products.$.qty":e.body.qty,modifiedOn:new Date}})];case 3:return r.sent(),[2,t.status(200).send({result:"ok"})];case 4:return n=r.sent(),[2,t.status(500).send(n)];case 5:return[2]}}))}))},t.DeleteCart=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(!i.bLogin(e))return[2,t.status(400).send("User not login.")];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,u.DbCollection("gifts-carts")];case 2:return r.sent().deleteOne({_id:new u.ObjectID(e.user._id)}),[2,t.status(200).send({result:"ok"})];case 3:return n=r.sent(),[2,t.status(500).send(n)];case 4:return[2]}}))}))},t.DeleteInCart=function(e,t,n){return r(this,void 0,void 0,(function(){var r;return s(this,(function(s){switch(s.label){case 0:if(!i.bLogin(e))return[2,n.status(400).send("User not login.")];s.label=1;case 1:return s.trys.push([1,4,,5]),[4,u.DbCollection("gifts-carts")];case 2:return[4,s.sent().updateOne({_id:new u.ObjectID(e.user._id)},{$pull:{products:{productId:new u.ObjectID(t)}}})];case 3:return s.sent(),[2,n.status(200).send({result:"ok"})];case 4:return r=s.sent(),[2,n.status(500).send(r)];case 5:return[2]}}))}))},t.CartCheckout=function(e,t){return r(this,void 0,void 0,(function(){var n,r,l,f,d,p;return s(this,(function(s){switch(s.label){case 0:if(!(e.body.cart&&e.body.cart.customer&&e.body.cart.customer.name&&e.body.cart.customer.mobile&&e.body.cart.customer.address))return[2,t.status(400).send("Invalid customer information.")];if(e.body.cart.total<=0)return[2,t.status(400).send("No product to checkout.")];n=i.bLogin(e.session),r="",r=n?e.session.user._id:o.randomString(20),l=e.body.cart.cartItems,f=e.body.cart.customer,s.label=1;case 1:return s.trys.push([1,10,,11]),[4,a.ReserveInventory(r,l)];case 2:return s.sent(),[4,c.NewOrder(f,l)];case 3:return s.sent().result.n<=0?[4,a.DeleteInventoryReservation(r)]:[3,5];case 4:throw s.sent(),"Create new order failed.";case 5:return[4,a.DeleteInventoryReservation(r)];case 6:return d=s.sent(),console.log(d),n?[4,u.DbCollection("gifts-carts")]:[3,9];case 7:return[4,s.sent().deleteOne({_id:new u.ObjectID(r)})];case 8:s.sent(),s.label=9;case 9:return[2,t.status(200).send({orderId:r})];case 10:return p=s.sent(),console.error(p),[2,t.status(500).send(p)];case 11:return[2]}}))}))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{a(r.next(e))}catch(e){u(e)}}function i(e){try{a(r.throw(e))}catch(e){u(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(3);t.NewOrder=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,u.DbCollection("gifts-orders")];case 1:return n=s.sent(),r=n.insertOne({created_on:new Date,shipping:{name:e.name,mobile:e.mobile,address:e.address,message:e.message},payment:{method:"visa",transaction_id:"2312213312XXXTD"},cartItems:t}),console.log("insertRslt: ",r),[2,r];case 2:throw s.sent(),"create new order failed.";case 3:return[2]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(32),u=r.Router();u.post("/admin/newStaff",(function(e,t){s.newStaff(e,t)})),u.delete("/deleteuser",(function(e,t){})),t.default=u},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{a(r.next(e))}catch(e){u(e)}}function i(e){try{a(r.throw(e))}catch(e){u(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(2),o=n(9);t.newStaff=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(s){switch(s.label){case 0:!e.session||e.session.staff,s.label=1;case 1:return s.trys.push([1,3,,4]),e.body.uid?("uid",n='"'+e.body.uid+'"',e.body.pwd?(",pwd",n+=',"'+o.encrypt(e.body.pwd)+'"',e.body.firstName?(",firstname",n+=',"'+e.body.firstName+'"',e.body.lastName?(",lastname",n+=',"'+e.body.lastName+'"',r="insert into giftsStaffs (uid,pwd,firstname,lastname) values ("+n+")",[4,u.SqliteRun(r)]):[2,t.status(400).send({result:"last name is empty."})]):[2,t.status(400).send({result:"first name is empty."})]):[2,t.status(400).send({result:"pwd is empty."})]):[2,t.status(400).send({result:"uid is empty."})];case 2:return!0===s.sent()?t.status(200).send({result:"ok"}):t.status(200).send({result:"failed"}),[3,4];case 3:return i=s.sent(),console.log(i),t.status(500).send(i),[3,4];case 4:return[2]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(34),u=r.Router();u.post("",(function(e,t){"DELETE"===e.body.type?s.Delete(e.body,t):"GET"===e.body.type?s.Get(e.body,t):"POST"===e.body.type?s.Post(e.body,t):"PUT"===e.body.type&&s.Put(e.body,t)})),t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);t.Delete=function(e,t){var n=e.url;if(e.querys&&e.querys.length>0){n+="?";for(var s=0;s<e.querys.length;++s)n+=e.query[s],n+="=",n+=e.queryValue[s]}r.default.delete(n).then((function(e){t.status(200).send(e)})).catch((function(e){t.status(400).send(e)}))},t.Post=function(e,t){return t.status(200).send(e)},t.Put=function(e,t){r.default.put(e.body.url).then((function(e){t.send(e.data)}))},t.Get=function(e,t){r.default.post(e.body.url).then((function(e){t.send(e.data)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(36).createTransport({host:"mail.insg.xyz",secure:!0,auth:{user:"i@insg.xyz",pass:"pass1234"}}),s={from:"i@insg.xyz",to:"seesea2@gmail.com",subject:"Hello",text:"This is email from InSG.xyz",html:"<b>this is email from InSG.xyz</b>"};t.default=function(e,t){return r.sendMail(s),t.status(200).send({result:"ok"})}},function(e,t){e.exports=require("nodemailer")}]);
//# sourceMappingURL=server.js.map