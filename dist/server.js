!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t){e.exports=require("express")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{i(r.next(e))}catch(e){u(e)}}function a(e){try{i(r.throw(e))}catch(e){u(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}i((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(21);t.ObjectID=u.ObjectID;var o,a="mongodb+srv://admin:admin@cluster0-dxwkg.mongodb.net/insg?retryWrites=true";function i(){return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,u.MongoClient.connect(a,{useNewUrlParser:!0})];case 1:return e=t.sent(),[2,o=e.db("insg")];case 2:throw t.sent(),"Database connection failed.";case 3:return[2]}}))}))}t.MongoDb=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:if(o)return[2,o];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,i()];case 2:return e.sent(),[2,o];case 3:throw e.sent();case 4:return[2]}}))}))},t.DbCollection=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:if(o)return[2,o.collection(e)];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,i()];case 2:return t.sent(),[2,o.collection(e)];case 3:throw t.sent();case 4:return[2]}}))}))}},function(e,t){e.exports=require("axios")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.busArrivalUrl="http://datamall2.mytransport.sg/ltaodataservice/BusArrivalv2";t.busStopsUrl="http://datamall2.mytransport.sg/ltaodataservice/BusStops";var r={headers:{AccountKey:"6sVzf9zXRaCgkJUdjxIw2A=="}};t.headerConfig=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{i(r.next(e))}catch(e){u(e)}}function a(e){try{i(r.throw(e))}catch(e){u(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}i((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(2),o=n(3),a=[];function i(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=o.busStopsUrl,e&&(t+="?$skip="+e),[4,u.default.get(t,o.headerConfig)];case 1:if(200!=(n=r.sent()).status)throw{status:n.status};return[2,n.data.value];case 2:throw r.sent();case 3:return[2]}}))}))}function c(e){if(e)for(var t=0;t<a.length;t++)if(e===a[t].BusStopCode)return a[t]}t.busStops=a,function e(){return r(this,void 0,void 0,(function(){var n,r,u;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,,6]),n=0,r=[],s.label=1;case 1:return[4,i(n)];case 2:r=s.sent(),u=a,t.busStops=a=u.concat(r),n+=500,s.label=3;case 3:if(500===r.length)return[3,1];s.label=4;case 4:return[3,6];case 5:return s.sent(),t.busStops=a=[],e(),[3,6];case 6:return[2]}}))}))}(),t.checkBusStopLocally=c,t.getBusStopInfo=function(e,t){if(!e)return t.status(400).send("Invalid Bus Stop Code.");var n=c(e);return n?t.status(200).send(n):t.status(400).send("Bus Stop Info not found.")},t.getNearbyBusStops=function(e,t,n){if(void 0===e||void 0===t)return n.status(400).send("Invalid coordinates.");for(var r=[],s=0;s<a.length;s++){var u=(a[s].Latitude-e)*Math.PI/180,o=(a[s].Longitude-t)*Math.PI/180,i=Math.sin(u/2)*Math.sin(u/2)+Math.cos(a[s].Latitude*Math.PI/180)*Math.cos(e*Math.PI/180)*Math.sin(o/2)*Math.sin(o/2),c=6371e3*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)));Math.abs(c)<280&&r.push(a[s])}n.status(200).send(r)}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{i(r.next(e))}catch(e){u(e)}}function a(e){try{i(r.throw(e))}catch(e){u(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}i((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(1);t.GetInventory=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,u.DbCollection("gifts-inventory")];case 1:return[4,r.sent().find().toArray()];case 2:return t=r.sent(),[2,e.status(200).send(t)];case 3:return n=r.sent(),[2,e.status(500).send(n.message)];case 4:return[2]}}))}))},t.AdjustInventory=function(e,t,n){return r(this,void 0,void 0,(function(){var r,o;return s(this,(function(s){switch(s.label){case 0:if(!e||!t)return[2,n.status(400).send("Invalid input.")];s.label=1;case 1:return s.trys.push([1,4,,5]),[4,u.DbCollection("gifts-inventory")];case 2:return[4,s.sent().updateOne({_id:new u.ObjectID(e)},{$set:{modifiedOn:new Date,qty:t}},{upsert:!0})];case 3:return r=s.sent(),[2,n.status(200).send(r)];case 4:return o=s.sent(),[2,n.status(500).send(o)];case 5:return[2]}}))}))},t.ReserveInventory=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o,a;return s(this,(function(s){switch(s.label){case 0:if(!t||t.length<=0)throw"The cart is empty.";s.label=1;case 1:return s.trys.push([1,7,,8]),n=[],r=[],[4,u.DbCollection("gifts-inventory")];case 2:o=s.sent(),a=0,s.label=3;case 3:return a<t.length?[4,o.updateOne({_id:new u.ObjectID(t[a].product._id),qty:{$gte:t[a].qty}},{$inc:{qty:-t[a].qty},$push:{reservations:{qty:t[a].qty,_id:new u.ObjectID(e),createdOn:new Date}}})]:[3,6];case 4:if(0===s.sent().result.nModified)return r.push(t[a].product),[3,6];n.push(t[a].product),s.label=5;case 5:return a++,[3,3];case 6:if(r.length>0){for(a=0;a<n.length;a++)o.updateOne({_id:n[a]._id,"reservations._id":e},{$inc:{qty:n[a].qty},$pull:{reservations:{_id:e}}});throw"Not enough storage."}return[2,"Success."];case 7:throw s.sent();case 8:return[2]}}))}))},t.DeleteInventoryReservation=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,u.DbCollection("gifts-inventory")];case 1:return[4,r.sent().updateOne({"reservations._id":new u.ObjectID(e)},{$pull:{reservations:{_id:new u.ObjectID(e)}}})];case 2:if((t=r.sent()).result.nModified<=0)throw"delete reservation failed.";return[2,t];case 3:throw n=r.sent(),console.log(n),"delete reservation failed with exception.";case 4:return[2]}}))}))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{i(r.next(e))}catch(e){u(e)}}function a(e){try{i(r.throw(e))}catch(e){u(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}i((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),o=n(7);function a(e){return!(!e||!e.user)}r(void 0,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,u.DbCollection("gifts-users")];case 1:return e.sent().createIndex("uid",{unique:!0}),[2]}}))})),t.Login=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return s(this,(function(s){switch(s.label){case 0:if(e.session&&e.session.user)return[2,t.status(200).send({uid:e.session.user.uid})];s.label=1;case 1:return s.trys.push([1,4,,5]),[4,u.DbCollection("gifts-users")];case 2:return n=s.sent(),r=e.session,[4,n.findOne({uid:e.body.uid,pwd:o.encrypt(e.body.pwd)})];case 3:return r.user=s.sent(),e.session.user?[2,t.status(200).send({uid:e.session.user.uid})]:[2,t.status(403).send("Incorrect username or password")];case 4:return s.sent(),[2,t.status(500).send("server error.")];case 5:return[2]}}))}))},t.Logout=function(e,t){return e.session&&e.session.user&&(e.session.user=null),t.status(200).send({result:"ok"})},t.Register=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(!(e.body.uid&&e.body.pwd&&e.body.email&&e.body.firstName&&e.body.lastName))return[2,t.status(400).send("Invalid input.")];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,u.DbCollection("gifts-users")];case 2:return[4,r.sent().insertOne({uid:e.body.uid,pwd:o.encrypt(e.body.pwd),email:e.body.email,firstName:e.body.firstName,lastName:e.body.lastName,createdOn:new Date})];case 3:return 1===(n=r.sent()).insertedCount?[2,t.status(200).send(n.ops[0])]:[2,t.status(500).send("Register failed. Please try again later.")];case 4:return r.sent(),[2,t.status(500).send("Register failed. Please try again later.")];case 5:return[2]}}))}))},t.DeleteUser=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(!e||!e.user)return[2,t.status(403).send("Login is required.")];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,u.MongoDb()];case 2:return r.sent().collection("gifts-users").deleteOne({_id:e.user._id}),e.user=null,[2,t.status(200).send({result:"User deleted."})];case 3:return n=r.sent(),[2,t.status(400).send(n)];case 4:return[2]}}))}))},t.UserInfo=function(e,t){return a(e)?t.status(200).send({_id:e.user._id,uid:e.user.uid,email:e.user.email}):t.status(403).send("User Not login.")},t.bLogin=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=n(29),u="aes-192-cbc",o=s.scryptSync("inSGyc83","salt",24),a=Buffer.alloc(16,0);function i(e,t){var n="";if(e===r.String)n="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";else if(e===r.Number)n="0123456789";else{if(e!==r.Capital)return"";n="ABCDEFGHIJKLMNOPQRSTUVWXYZ"}for(var s="",u=t;u>0;--u)s+=n[Math.floor(Math.random()*n.length)];return s}t.encrypt=function(e){try{var t=s.createCipheriv(u,o,a),n=t.update(e,"utf8","hex");return n+=t.final("hex")}catch(e){}},t.decrypt=function(e){try{var t=s.createDecipheriv(u,o,a),n=t.update(e,"hex","utf8");return n+=t.final("utf8")}catch(e){}},function(e){e[e.Capital=0]="Capital",e[e.Number=1]="Number",e[e.String=2]="String"}(r||(r={})),t.RandomTypes=r,t.randomNumber=function(e){return i(r.Number,e)},t.randomCapitals=function(e){return i(r.Capital,e)},t.randomString=function(e){return i(r.String,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(9),u=n(10),o=n(11),a=n(12),i=n(13),c=r();c.use(o()),c.use(a.json()),c.use(a.urlencoded({extended:!1})),c.use(s({secret:"insg-yc-ly-17",resave:!1,saveUninitialized:!0,cookie:{maxAge:864e5}})),c.use("/api",i.default),c.get("/",(function(e,t){return t.status(200).sendFile(u.join(__dirname,"/client/index.html"))})),c.use(r.static(u.join(__dirname,"/client"))),c.use(r.static(u.join(__dirname,"/client/assets"),{dotfiles:"allow"})),c.all("/*",(function(e,t){return t.status(200).sendFile(u.join(__dirname,"/client/index.html"))})),c.use((function(e,t,n){return t.status(500).send("Issue happened. Please retry later!")})),c.listen(8080,(function(){console.log("app listening on port 8080.")}))},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("body-parser")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(14),u=n(16),o=n(18),a=n(23),i=n(33),c=r.Router();c.use("/dictionary",o.dictionaryRouter),c.use("/http",u.default),c.use("/lunchfun",o.lunchfunRouter),c.use("/lta/bus",s.busRouter),c.use("/gifts",a.default),c.post("/msg",(function(e,t){i.default(e.body,t)})),c.all("/*",(function(e,t){return t.status(400).send("Invalid Request")})),t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(15),u=n(4),o=r.Router();t.busRouter=o,o.get("/busArrival/:busStopCode",(function(e,t){s.default(e.params.busStopCode,t)})),o.get("/busStop/:busStopCode",(function(e,t){u.getBusStopInfo(e.params.busStopCode,t)})),o.get("/nearbyBusStops",(function(e,t){u.getNearbyBusStops(e.query.latitude,e.query.longitude,t)}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),s=n(3),u=n(4);t.default=function(e,t){if(!(e=e.trim()))return t.status(400).send("Invalid BusStopCode.");var n=u.checkBusStopLocally(e);if(!n)return t.status(400).send("Bus Stop not found.");var o=s.busArrivalUrl+"?BusStopCode="+e;r.default.get(o,s.headerConfig).then((function(e){t.status(200).send({busStopInfo:n,busArrival:e.data})})).catch((function(e){t.status(400).send(e)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(17),u=r.Router();u.post("",(function(e,t){"DELETE"===e.body.type?s.Delete(e.body,t):"GET"===e.body.type?s.Get(e.body,t):"POST"===e.body.type?s.Post(e.body,t):"PUT"===e.body.type&&s.Put(e.body,t)})),t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);t.Delete=function(e,t){var n=e.url;if(e.querys&&e.querys.length>0){n+="?";for(var s=0;s<e.querys.length;++s)n+=e.query[s],n+="=",n+=e.queryValue[s]}r.default.delete(n).then((function(e){t.status(200).send(e)})).catch((function(e){t.status(400).send(e)}))},t.Post=function(e,t){return t.status(200).send(e)},t.Put=function(e,t){r.default.put(e.body.url).then((function(e){t.send(e.data)}))},t.Get=function(e,t){r.default.post(e.body.url).then((function(e){t.send(e.data)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(19),u=n(20),o=n(22),a=r.Router();t.dictionaryRouter=a;var i=r.Router();t.lunchfunRouter=i,a.get("/oxford/:word",(function(e,t){s.default(e.params.word,t)})),i.get("/pals",(function(e,t){u.GetPals(t)})),i.post("/pal",(function(e,t){u.AddPal(e.body.name,t)})),i.delete("/pal",(function(e,t){u.DeletePal(e.query,t)})),i.get("/records",(function(e,t){o.GetRecords(t)})),i.post("/record",(function(e,t){o.AddRecord(e.body.payer,e.body.attendees,t)})),i.delete("/record",(function(e,t){o.DeleteRecord(e.query._id,t)})),i.get("/stats/attendance",(function(e,t){u.GetPalsAttendance(t)}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{i(r.next(e))}catch(e){u(e)}}function a(e){try{i(r.throw(e))}catch(e){u(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}i((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(2),o={headers:{app_id:"0314e9e2",app_key:"5a6c2589474a2f83ccd69f397bfec7a2"}};!function(e){r(this,void 0,void 0,(function(){var t,n,r,a;return s(this,(function(s){switch(s.label){case 0:if(!e||!e.trim())return[2,"Invalid word."];t="https://od-api.oxforddictionaries.com/api/v2/lemmas/en-gb/"+e,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,u.default(t,o)];case 2:return n=s.sent(),r=n.data,a=[],r.results.forEach((function(e){e.lexicalEntries.forEach((function(e){e.inflectionOf.forEach((function(e){a.push(e)}))}))})),[2,a];case 3:return[2,s.sent().message];case 4:return[2]}}))}))}("shops"),t.default=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,i,c,l,d,f,p,h,b,y,v,g,w,_,m,x,O,D,I,C,P,k,S,j,M,q,G;return s(this,(function(s){switch(s.label){case 0:if(!e||!e.trim())return[2,t.status(400).send("Invalid word.")];e=e.trim().toLowerCase(),n="https://od-api.oxforddictionaries.com/api/v2/entries/en-gb/"+e+"?fields=definitions%2Cpronunciations",s.label=1;case 1:return s.trys.push([1,3,,4]),[4,u.default(n,o)];case 2:for(r=s.sent(),a=r.data,i={lexicalEntries:[]},c=0,l=a.results;c<l.length;c++)for(d=l[c],f=0,p=d.lexicalEntries;f<p.length;f++){for(h=p[f],b={entries:[],lexicalCategory:"",pronunciations:[]},i.lexicalEntries.push(b),h.lexicalCategory&&(b.lexicalCategory=h.lexicalCategory.text),y=0,v=h.entries;y<v.length;y++)for(g=v[y],w=0,_=g.senses;w<_.length;w++){for(m=_[w],x=0,O=m.definitions;x<O.length;x++)S=O[x],b.entries.push(S);for(D=0,I=m.subsenses||[];D<I.length;D++)for(C=I[D],P=0,k=C.definitions;P<k.length;P++)S=k[P],b.entries.push(S)}for(j=0,M=h.pronunciations;j<M.length;j++)q=M[j],b.pronunciations.push({audioFile:q.audioFile,phoneticSpelling:q.phoneticSpelling})}return[2,t.status(200).send(i)];case 3:return G=s.sent(),[2,t.status(400).send(G.message)];case 4:return[2]}}))}))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{i(r.next(e))}catch(e){u(e)}}function a(e){try{i(r.throw(e))}catch(e){u(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}i((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),o=[];function a(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,u.DbCollection("lunchfun-pals")];case 1:return[4,e.sent().find().sort({name:1}).toArray()];case 2:return o=e.sent(),[3,4];case 3:throw e.sent();case 4:return[2]}}))}))}t.GetPals=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:if(o.length>0)return[2,e.status(200).send(o)];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,a()];case 2:return n.sent(),[2,e.status(200).send(o)];case 3:return t=n.sent(),[2,e.status(500).send(t)];case 4:return[2]}}))}))},t.AddPal=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(!e)return[2,t.status(400).send("Invalid input.")];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,u.DbCollection("lunchfun-pals")];case 2:return r.sent().insertOne({name:e}),a(),[2,t.status(200).send({result:"ok"})];case 3:return n=r.sent(),[2,t.status(500).send(n)];case 4:return[2]}}))}))},t.DeletePal=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(!e)return[2,t.status(400).send("Invalid name to delete.")];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,u.DbCollection("lunchfun-pals")];case 2:return r.sent().deleteOne({name:e}),a(),[2,t.status(200).send({result:"ok"})];case 3:return n=r.sent(),[2,t.status(500).send(n)];case 4:return[2]}}))}))},t.GetPalsAttendance=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,u.DbCollection("lunchfun-records")];case 1:return[4,r.sent().aggregate([{$unwind:"$attendees"},{$group:{_id:"$attendees",attendance:{$sum:1}}},{$project:{name:"$_id",attendance:"$attendance"}}]).toArray()];case 2:return t=r.sent(),[2,e.status(200).send(t)];case 3:return n=r.sent(),[2,e.status(500).send(n)];case 4:return[2]}}))}))}},function(e,t){e.exports=require("mongodb")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{i(r.next(e))}catch(e){u(e)}}function a(e){try{i(r.throw(e))}catch(e){u(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}i((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(1);t.GetRecords=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,u.DbCollection("lunchfun-records")];case 1:return[4,s.sent().find({}).sort({createdOn:-1}).limit(30|t).toArray()];case 2:return n=s.sent(),[2,e.status(200).send(n)];case 3:return r=s.sent(),[2,e.status(500).send(r)];case 4:return[2]}}))}))},t.AddRecord=function(e,t,n){return r(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:if(!e||!t||t.length<=0)return[2,n.status(400).send("Invalid params to add.")];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,u.DbCollection("lunchfun-records")];case 2:return[4,r.sent().insertOne({payer:e,attendees:t,createdOn:new Date})];case 3:return r.sent(),[2,n.status(200).send({result:"ok"})];case 4:return r.sent(),[2,n.status(500).send("Error at server. Please try again later.")];case 5:return[2]}}))}))},t.DeleteRecord=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(!e)return[2,t.status(400).send("Invalid record to delete.")];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,u.DbCollection("lunchfun-records")];case 2:return r.sent().deleteOne({_id:new u.ObjectID(e)}),[2,t.status(200).send({result:"ok"})];case 3:return n=r.sent(),[2,t.status(500).send(n)];case 4:return[2]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(24),u=n(27),o=n(28),a=n(32),i=r.Router();i.use("/products",s.default),i.use("/orders",u.default),i.use("/users",o.default),i.use("/staffs",a.default),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(25),u=n(26),o=n(5),a=r.Router();a.get("/view/:product_no",(function(e,t){u.GetProduct(e.params,t)})),a.get("/categories",(function(e,t){s.GetCategories(t)})),a.post("/category",(function(e,t){s.AddCategory(e.body,t)})),a.delete("/category",(function(e,t){s.DeleteCategory(e.query,t)})),a.get("/samples",(function(e,t){s.GetSamplesOfCategories(t)})),a.get("",(function(e,t){u.GetProductsByCategory(e,t)})),a.get("/product",(function(e,t){u.GetProduct(e.query,t)})),a.post("/product",(function(e,t){u.AddProduct(e.body,t)})),a.put("/product",(function(e,t){u.UpdateProduct(e.body,t)})),a.delete("/product",(function(e,t){u.DeleteProduct(e.query,t)})),a.get("/inventory",(function(e,t){o.GetInventory(t)})),a.put("/inventory",(function(e,t){o.AdjustInventory(e.body._id,e.body.qty,t)})),t.default=a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{i(r.next(e))}catch(e){u(e)}}function a(e){try{i(r.throw(e))}catch(e){u(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}i((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),o=[],a=[];function i(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:if(!(o.length<=0))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,c()];case 2:return o=n.sent(),[3,4];case 3:throw n.sent();case 4:return 0===e?[2,o]:(t=[],o.forEach((function(n){console.log(n.category.match(new RegExp("/","g"))),n.category.match(new RegExp("/","g")).length<=e&&t.push(n)})),[2,t])}}))}))}function c(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,u.DbCollection("gifts-products-catalog")];case 1:return[4,e.sent().find().sort("category",1).toArray()];case 2:return[2,o=e.sent()];case 3:throw e.sent(),{errMsg:"Get categories from database failed."};case 4:return[2]}}))}))}function l(){return r(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,u.DbCollection("gifts-products")];case 1:return e=n.sent(),null,[4,e.aggregate([{$sort:{_id:-1}},{$group:{_id:{category:"$category"},products:{$push:{_id:"$_id",category:"$category",img:"$img"}}}},{$project:{_id:"$_id",products:{$slice:["$products",4]}}}]).toArray()];case 2:return[2,n.sent()];case 3:return t=n.sent(),console.log(t),[2,{errMsg:"Get products failed."}];case 4:return[2]}}))}))}t.GetCategories=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,i(0)];case 1:return t=r.sent(),[2,e.status(200).send(t)];case 2:return n=r.sent(),[2,e.status(500).send(n)];case 3:return[2]}}))}))},t.GetSamplesOfCategories=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:if(a.length>0)return[2,e.status(200).send(a)];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,l()];case 2:return a=n.sent(),[2,e.status(200).send(a)];case 3:return t=n.sent(),[2,e.status(500).send(t)];case 4:return[2]}}))}))},t.AddCategory=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(!e.name||!e.category)return[2,t.status(400).send("Invalid input.")];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,u.DbCollection("gifts-products-catalog")];case 2:return[4,r.sent().insertOne({name:e.name,category:e.category})];case 3:return r.sent(),o=[],a=[],[2,t.status(200).send({result:"ok"})];case 4:return n=r.sent(),[2,t.status(500).send(n)];case 5:return[2]}}))}))},t.DeleteCategory=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(!e._id)return[2,t.status(400).send("Invalid input.")];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,u.DbCollection("gifts-products-catalog")];case 2:return[4,r.sent().deleteOne({_id:new u.ObjectID(e._id)})];case 3:return r.sent(),o=[],a=[],[2,t.status(200).send({result:"ok"})];case 4:return n=r.sent(),[2,t.status(500).send(n)];case 5:return[2]}}))}))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{i(r.next(e))}catch(e){u(e)}}function a(e){try{i(r.throw(e))}catch(e){u(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}i((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(1);t.GetProduct=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return s(this,(function(s){switch(s.label){case 0:if(!e._id)return[2,t.status(400).send("Invalid product no.")];s.label=1;case 1:return s.trys.push([1,4,,5]),[4,u.MongoDb()];case 2:return[4,s.sent().collection("gifts-products").findOne({_id:new u.ObjectID(e._id)})];case 3:return n=s.sent(),[2,t.status(200).send(n)];case 4:return r=s.sent(),[2,t.status(500).send(r)];case 5:return[2]}}))}))},t.GetProductsByCategory=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o,a;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,6,,7]),[4,u.DbCollection("gifts-products")];case 1:return n=s.sent(),r=null,e.query.category?(o=new RegExp(["^",e.query.category.trim()].join(""),"i"),[4,n.find({category:o}).toArray()]):[3,3];case 2:return r=s.sent(),[3,5];case 3:return[4,n.find().toArray()];case 4:r=s.sent(),s.label=5;case 5:return[2,t.status(200).send(r)];case 6:return a=s.sent(),[2,t.status(500).send(a)];case 7:return[2]}}))}))},t.AddProduct=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(!e.name)return[2,t.status(400).send("Invalid input.")];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,u.MongoDb()];case 2:return[4,r.sent().collection("gifts-products").insertOne({name:e.name,img:e.img,price:e.price,category:e.category,color:e.color,packaging:e.packaging,material:e.material,size:e.size,note:e.note,retailer:e.retailer,createdOn:new Date})];case 3:return r.sent(),[2,t.status(200).send({result:"ok"})];case 4:return n=r.sent(),[2,t.status(500).send(n)];case 5:return[2]}}))}))},t.UpdateProduct=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(!e._id)return[2,t.status(400).send("Invalid input.")];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,u.DbCollection("gifts-products")];case 2:return[4,r.sent().updateOne({_id:new u.ObjectID(e._id)},{$set:{modifiedOn:new Date,name:e.name,img:e.img,price:e.price,category:e.category,color:e.color,packaging:e.packaging,material:e.material,size:e.size,note:e.note,retailer:e.retailer}})];case 3:return r.sent(),[2,t.status(200).send({result:"ok"})];case 4:return n=r.sent(),[2,t.status(500).send(n)];case 5:return[2]}}))}))},t.DeleteProduct=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(!e._id)return[2,t.status(400).send("Invalid input.")];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,u.MongoDb()];case 2:return[4,r.sent().collection("gifts-products").deleteOne({_id:new u.ObjectID(e._id)})];case 3:return r.sent(),[2,t.status(200).send({result:"ok"})];case 4:return n=r.sent(),[2,t.status(500).send(n)];case 5:return[2]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0).Router();r.get("/allOrders",(function(e,t){return e.session&&e.session.staff?t.status(200).send({result:"ok"}):t.sendStatus(401)})),r.put("/updateStatus",(function(e,t){if(!e.session||!e.session.staff.id)return t.sendStatus(401);if(!e.body.new_status||!e.body.sno||!e.body.order_no)return t.status(400).send("Failed. Pleaes review inputs.");e.body.order_no,e.body.sno,Date.now(),e.session.staff.id,e.body.new_status,e.body.note;return t.status(200).send({result:"ok"})})),r.put("/updateContact",(function(e,t){if(!e.session||!e.session.staff.id)return t.sendStatus(401);if(!e.body.order_no)return t.status(400).send("Order_no empty.");if(!(e.body.email&&e.body.email.includes("@")&&e.body.email.includes("."))||e.body.email.includes("/")||e.body.email.includes("\\"))return t.status(400).send("Invalid email.");if(!e.body.name)return t.status(400).send("Invalid name.");e.body.name,e.body.email,e.body.mobile,e.body.company,e.body.mobile2,e.body.addr,e.body.order_no;return t.status(200).send({result:"ok"})})),r.put("/updateOrderItem",(function(e,t){if(!e.session||!e.session.staff.id)return t.sendStatus(401);if(!e.body.order_no)return t.status(400).send("Failed. Invalid Order No.");if(!e.body.sno||""===e.body.sno)return t.status(400).send("Failed. Invalid Order Sno.");e.body.new_sale_price,e.body.new_qty,e.body.new_status,e.body.order_no,e.body.sno;return t.status(200).send({result:"ok"})})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(6),u=n(30),o=r.Router();o.post("/login",(function(e,t){s.Login(e,t)})),o.get("/info",(function(e,t){s.UserInfo(e.session,t)})),o.get("/logout",(function(e,t){s.Logout(e,t)})),o.post("/register",(function(e,t){s.Register(e,t)})),o.delete("/deleteuser",(function(e,t){s.DeleteUser(e.session,t)})),o.get("/cart",(function(e,t){u.GetCart(e.session,t)})),o.post("/cart",(function(e,t){u.AddToCart(e.session,e.body,t)})),o.delete("/cart",(function(e,t){u.DeleteCart(e.session,t)})),o.put("/cart",(function(e,t){u.UpdateCartQty(e,t)})),o.delete("/cart/product",(function(e,t){u.DeleteInCart(e.session,e.query._id,t)})),o.post("/cart/checkout",(function(e,t){u.CartCheckout(e,t)})),t.default=o},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{i(r.next(e))}catch(e){u(e)}}function a(e){try{i(r.throw(e))}catch(e){u(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}i((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),o=n(7),a=n(6),i=n(5),c=n(31);t.GetCart=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return s(this,(function(s){switch(s.label){case 0:if(!a.bLogin(e))return[2,t.status(403).send("User not login")];s.label=1;case 1:return s.trys.push([1,4,,5]),[4,u.DbCollection("gifts-carts")];case 2:return[4,s.sent().findOne({_id:new u.ObjectID(e.user._id)})];case 3:return n=s.sent(),console.log(n),[2,t.status(200).send(n)];case 4:return r=s.sent(),[2,t.status(500).send(r)];case 5:return[2]}}))}))},t.AddToCart=function(e,t,n){return r(this,void 0,void 0,(function(){var r,o;return s(this,(function(s){switch(s.label){case 0:if(!a.bLogin(e))return[2,n.status(403).send("User not login")];s.label=1;case 1:return s.trys.push([1,5,,6]),[4,u.DbCollection("gifts-carts")];case 2:return[4,(r=s.sent()).updateOne({_id:new u.ObjectID(e.user._id)},{$pull:{products:{productId:new u.ObjectID(t.product._id)}}})];case 3:return s.sent(),[4,r.updateOne({_id:new u.ObjectID(e.user._id)},{$push:{products:{productId:new u.ObjectID(t.product._id),quantity:t.qty,name:t.product.name,price:t.product.price}}},{upsert:!0})];case 4:return s.sent(),[2,n.status(200).send({result:"ok"})];case 5:return o=s.sent(),[2,n.status(500).send(o)];case 6:return[2]}}))}))},t.UpdateCartQty=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(a.bLogin(e.session)||t.status(403).send("User not login."),!e.body.productId||!e.body.qty)return[2,t.status(400).send("Invalid input.")];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,u.MongoDb()];case 2:return[4,r.sent().collection("gifts-carts").updateOne({_id:e.session.user._id,"products.productId":e.body.productId},{$set:{"products.$.qty":e.body.qty,modifiedOn:new Date}})];case 3:return r.sent(),[2,t.status(200).send({result:"ok"})];case 4:return n=r.sent(),[2,t.status(500).send(n)];case 5:return[2]}}))}))},t.DeleteCart=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(!a.bLogin(e))return[2,t.status(400).send("User not login.")];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,u.DbCollection("gifts-carts")];case 2:return r.sent().deleteOne({_id:new u.ObjectID(e.user._id)}),[2,t.status(200).send({result:"ok"})];case 3:return n=r.sent(),[2,t.status(500).send(n)];case 4:return[2]}}))}))},t.DeleteInCart=function(e,t,n){return r(this,void 0,void 0,(function(){var r;return s(this,(function(s){switch(s.label){case 0:if(!a.bLogin(e))return[2,n.status(400).send("User not login.")];s.label=1;case 1:return s.trys.push([1,4,,5]),[4,u.DbCollection("gifts-carts")];case 2:return[4,s.sent().updateOne({_id:new u.ObjectID(e.user._id)},{$pull:{products:{productId:new u.ObjectID(t)}}})];case 3:return s.sent(),[2,n.status(200).send({result:"ok"})];case 4:return r=s.sent(),[2,n.status(500).send(r)];case 5:return[2]}}))}))},t.CartCheckout=function(e,t){return r(this,void 0,void 0,(function(){var n,r,l,d,f,p;return s(this,(function(s){switch(s.label){case 0:if(!(e.body.cart&&e.body.cart.customer&&e.body.cart.customer.name&&e.body.cart.customer.mobile&&e.body.cart.customer.address))return[2,t.status(400).send("Invalid customer information.")];if(e.body.cart.total<=0)return[2,t.status(400).send("No product to checkout.")];n=a.bLogin(e.session),r="",r=n?e.session.user._id:o.randomString(20),l=e.body.cart.cartItems,d=e.body.cart.customer,s.label=1;case 1:return s.trys.push([1,10,,11]),[4,i.ReserveInventory(r,l)];case 2:return s.sent(),[4,c.NewOrder(d,l)];case 3:return s.sent().result.n<=0?[4,i.DeleteInventoryReservation(r)]:[3,5];case 4:throw s.sent(),"Create new order failed.";case 5:return[4,i.DeleteInventoryReservation(r)];case 6:return f=s.sent(),console.log(f),n?[4,u.DbCollection("gifts-carts")]:[3,9];case 7:return[4,s.sent().deleteOne({_id:new u.ObjectID(r)})];case 8:s.sent(),s.label=9;case 9:return[2,t.status(200).send({orderId:r})];case 10:return p=s.sent(),console.error(p),[2,t.status(500).send(p)];case 11:return[2]}}))}))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,u){function o(e){try{i(r.next(e))}catch(e){u(e)}}function a(e){try{i(r.throw(e))}catch(e){u(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}i((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(1);t.NewOrder=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,u.DbCollection("gifts-orders")];case 1:return n=s.sent(),r=n.insertOne({created_on:new Date,shipping:{name:e.name,mobile:e.mobile,address:e.address,message:e.message},payment:{method:"visa",transaction_id:"2312213312XXXTD"},cartItems:t}),console.log("insertRslt: ",r),[2,r];case 2:throw s.sent(),"create new order failed.";case 3:return[2]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0).Router();r.post("/login",(function(e,t){})),r.get("/logout",(function(e,t){})),r.post("/register",(function(e,t){})),r.delete("/deleteuser",(function(e,t){})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(34).createTransport({host:"mail.insg.xyz",secure:!0,auth:{user:"i@insg.xyz",pass:"pass1234"}}),s={from:"i@insg.xyz",to:"seesea2@gmail.com",subject:"Hello",text:"This is email from InSG.xyz",html:"<b>this is email from InSG.xyz</b>"};function u(e,t){r.sendMail(s)}u(),t.default=u},function(e,t){e.exports=require("nodemailer")}]);
//# sourceMappingURL=server.js.map