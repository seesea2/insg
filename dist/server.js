!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(e,t){e.exports=require("express")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function u(e){try{o(r.next(e))}catch(e){i(e)}}function a(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}o((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,i,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(s=(s=u.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){u.label=i[1];break}if(6===i[0]&&u.label<s[1]){u.label=s[1],s=i;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(i);break}s[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),u=n(22),a=i.join(__dirname,"/../info.xyz"),o=u.verbose(),c=void 0,l=void 0;function d(){c&&(c.close(),c=void 0),l&&(l.close(),l=void 0)}t.SqliteGet=function(e){var t=this;return new Promise((function(n,i){return r(t,void 0,void 0,(function(){return s(this,(function(t){try{c||(c=new o.Database(a,u.OPEN_READONLY)),c.get(e,(function(e,t){if(e)return d(),i(e);n(t)}))}catch(e){d(),i(e)}return[2]}))}))}))},t.SqliteAll=function(e){var t=this;return new Promise((function(n,i){return r(t,void 0,void 0,(function(){return s(this,(function(t){try{c||(c=new o.Database(a,u.OPEN_READONLY)),c.all(e,(function(e,t){if(e)return d(),i(e);n(t)}))}catch(e){d(),i(e)}return[2]}))}))}))},t.SqliteRun=function(e){var t=this;return new Promise((function(n,i){return r(t,void 0,void 0,(function(){return s(this,(function(t){try{l||(l=new o.Database(a,u.OPEN_READWRITE)),l.run(e,[],(function(e){if(e)return d(),i(e);n(!0)}))}catch(e){d(),i(e)}return[2]}))}))}))},t.SqlitePrepareRun=function(e,t){var n=this;return new Promise((function(i,c){return r(n,void 0,void 0,(function(){return s(this,(function(n){try{l||(l=new o.Database(a,u.OPEN_READWRITE)),l.serialize((function(){for(var n=l.prepare(e,(function(e){if(e)return d(),c(e)})),r=0;r<t.length;r++)n.run(t[r]);n.finalize((function(e){if(e)return d(),c(e);i(!0)}))}))}catch(e){d(),c(e)}return[2]}))}))}))}},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);t.busArrivalUrl="http://datamall2.mytransport.sg/ltaodataservice/BusArrivalv2";t.busStopsUrl="http://datamall2.mytransport.sg/ltaodataservice/BusStops";var s={headers:{AccountKey:r.ltaAccountKey}};t.headerConfig=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ltaAccountKey="6sVzf9zXRaCgkJUdjxIw2A==",t.oxford_app_id="0314e9e2",t.oxford_app_key="5a6c2589474a2f83ccd69f397bfec7a2"},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function u(e){try{o(r.next(e))}catch(e){i(e)}}function a(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}o((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,i,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(s=(s=u.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){u.label=i[1];break}if(6===i[0]&&u.label<s[1]){u.label=s[1],s=i;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(i);break}s[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),u=n(4),a=[];function o(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=u.busStopsUrl,e&&(t+="?$skip="+e),[4,i.default.get(t,u.headerConfig)];case 1:if(200!=(n=r.sent()).status)throw{status:n.status};return[2,n.data.value];case 2:throw r.sent();case 3:return[2]}}))}))}function c(e){if(e)for(var t=0;t<a.length;t++)if(e===a[t].BusStopCode)return a[t]}t.busStops=a,function e(){return r(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,,6]),n=0,r=[],s.label=1;case 1:return[4,o(n)];case 2:r=s.sent(),i=a,t.busStops=a=i.concat(r),n+=500,s.label=3;case 3:if(500===r.length)return[3,1];s.label=4;case 4:return[3,6];case 5:return s.sent(),t.busStops=a=[],e(),[3,6];case 6:return[2]}}))}))}(),t.checkBusStopLocally=c,t.getBusStopInfo=function(e,t){if(!e)return t.status(400).send("Invalid Bus Stop Code.");var n=c(e);return n?t.status(200).send(n):t.status(400).send("Bus Stop Info not found.")},t.getNearbyBusStops=function(e,t,n){if(void 0===e||void 0===t)return n.status(400).send("Invalid coordinates.");for(var r=[],s=0;s<a.length;s++){var i=(a[s].Latitude-e)*Math.PI/180,u=(a[s].Longitude-t)*Math.PI/180,o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(a[s].Latitude*Math.PI/180)*Math.cos(e*Math.PI/180)*Math.sin(u/2)*Math.sin(u/2),c=6371e3*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)));Math.abs(c)<280&&r.push(a[s])}n.status(200).send(r)}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function u(e){try{o(r.next(e))}catch(e){i(e)}}function a(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}o((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,i,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(s=(s=u.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){u.label=i[1];break}if(6===i[0]&&u.label<s[1]){u.label=s[1],s=i;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(i);break}s[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);t.GetInventory=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),"select coalesce(i.qty, 0) as inventory, p.* from giftsProducts as p \n                left JOIN giftsInventory as i\n                on p.product_id=i.product_id;",[4,i.SqliteAll("select coalesce(i.qty, 0) as inventory, p.* from giftsProducts as p \n                left JOIN giftsInventory as i\n                on p.product_id=i.product_id;")];case 1:return t=r.sent(),[2,e.status(200).send(t)];case 2:return n=r.sent(),[2,e.status(500).send(n.message)];case 3:return[2]}}))}))},t.AdjustInventory=function(e,t){return r(this,void 0,void 0,(function(){var n,r,u;return s(this,(function(s){switch(s.label){case 0:if(!e.product_id||!e.qty)return[2,t.status(400).send("Invalid input.")];s.label=1;case 1:return s.trys.push([1,3,,4]),n=Date.now(),r="insert into giftsInventory (product_id,qty,modifiedOn) \n                values("+e.product_id+","+e.qty+","+n+")\n                on CONFLICT(product_id) do update set qty="+e.qty+", modifiedOn="+n+";",[4,i.SqliteRun(r)];case 2:return s.sent()?[2,t.status(200).send("OK")]:[2,t.status(500).send("Failed")];case 3:return u=s.sent(),[2,t.status(500).send(u)];case 4:return[2]}}))}))},t.ReserveInventory=function(e,t){return r(this,void 0,void 0,(function(){var n,r,u,a,o;return s(this,(function(s){switch(s.label){case 0:if(!e||!t||t.length<=0)throw"The order is empty.";s.label=1;case 1:s.trys.push([1,13,,14]),n=[],r=[],u="",!1,!1,o=0,s.label=2;case 2:return o<t.length?(a=t[o].qty,u="insert into giftsReservation (product_id,order_id,qty,createdOn) \n            values ("+t[o].product_id+',"'+e+'",'+a+","+Date.now()+");",[4,i.SqliteRun(u)]):[3,6];case 3:return s.sent()?(u="update giftsInventory set qty=qty-"+a+" where product_id="+t[o].product_id+";",[4,i.SqliteRun(u)]):[3,6];case 4:if(!s.sent())return r.push(t[o]),[3,6];n.push(t[o]),s.label=5;case 5:return o++,[3,2];case 6:if(!r.length)return[3,12];o=0,s.label=7;case 7:return o<n.length?(u="update giftsInventory set qty=qty+"+n[o].qty+" where product_id="+n[o].product_id+";",[4,i.SqliteRun(u)]):[3,12];case 8:return s.sent()?(u='delete from giftsReservation where order_id="'+e+'" and product_id='+n[o].product_id+";",[4,i.SqliteRun(u)]):[3,11];case 9:return s.sent()?[3,11]:[4,i.SqliteRun(u)];case 10:s.sent(),s.label=11;case 11:return o++,[3,7];case 12:if(n.length!=t.length)throw"Reserve from Inventory failed.";return[2,!0];case 13:throw s.sent();case 14:return[2]}}))}))}},function(e,t,n){"use strict";var r;function s(e,t){var n="";switch(e){case r.String:n="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";break;case r.Number:n="0123456789";break;case r.Capital:n="ABCDEFGHIJKLMNOPQRSTUVWXYZ";break;default:return""}for(var s="",i=t;i>0;--i)s+=n[Math.floor(Math.random()*n.length)];return s}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Capital=0]="Capital",e[e.Number=1]="Number",e[e.String=2]="String"}(r||(r={})),t.randomNumber=function(e){return s(r.Number,e)},t.randomCapitals=function(e){return s(r.Capital,e)},t.randomString=function(e){return s(r.String,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(28),s="aes-192-cbc",i=r.scryptSync("inSGyc83","salt",24),u=Buffer.alloc(16,0);t.encrypt=function(e){try{var t=r.createCipheriv(s,i,u),n=t.update(e,"utf8","hex");return n+=t.final("hex")}catch(e){}},t.decrypt=function(e){try{var t=r.createDecipheriv(s,i,u),n=t.update(e,"hex","utf8");return n+=t.final("utf8")}catch(e){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(11),i=n(3),u=n(12),a=n(13),o=n(14),c=n(8),l=r();l.use(u()),l.use(a.json()),l.use(a.urlencoded({extended:!1})),l.use(s({secret:c.randomString(20),resave:!1,saveUninitialized:!0,cookie:{maxAge:864e5}})),l.use("/api",o.default),l.get("/",(function(e,t){return t.status(200).sendFile(i.join(__dirname,"/client/index.html"))})),l.use(r.static(i.join(__dirname,"/client"))),l.use(r.static(i.join(__dirname,"/client/assets"),{dotfiles:"allow"})),l.all("/*",(function(e,t){return t.status(200).sendFile(i.join(__dirname,"/client/index.html"))})),l.all("/*",(function(e,t){return t.status(404).send({result:"Page not found."})})),l.use((function(e,t,n){return t.status(500).send("Issue happened. Please retry later!")})),l.listen(8080,(function(){console.log("Listening HTTP on port 8080.")}))},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("body-parser")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(15),i=n(17),u=n(19),a=n(31),o=r.Router();o.use("/lta/bus",s.busRouter),o.use("/dictionary",i.default),o.use("/gifts",u.default),o.post("/msg",(function(e,t){a.default(e.body,t)})),o.all("/*",(function(e,t){return t.status(400).send("Invalid Request")})),t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(16),i=n(6),u=r.Router();t.busRouter=u,u.get("/busArrival/:busStopCode",(function(e,t){s.default(e.params.busStopCode,t)})),u.get("/busStop/:busStopCode",(function(e,t){i.getBusStopInfo(e.params.busStopCode,t)})),u.get("/nearbyBusStops",(function(e,t){i.getNearbyBusStops(e.query.latitude,e.query.longitude,t)}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),s=n(4),i=n(6);t.default=function(e,t){if(!(e=e.trim()))return t.status(400).send("Invalid BusStopCode.");var n=i.checkBusStopLocally(e);if(!n)return t.status(400).send("Bus Stop not found.");var u=s.busArrivalUrl+"?BusStopCode="+e;r.default.get(u,s.headerConfig).then((function(e){t.status(200).send({busStopInfo:n,busArrival:e.data})})).catch((function(e){t.status(400).send(e)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(18),i=r.Router();i.get("/oxford/:word",(function(e,t){s.default(e.params.word,t)})),t.default=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function u(e){try{o(r.next(e))}catch(e){i(e)}}function a(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}o((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,i,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(s=(s=u.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){u.label=i[1];break}if(6===i[0]&&u.label<s[1]){u.label=s[1],s=i;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(i);break}s[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),u=n(5),a={headers:{app_id:u.oxford_app_id,app_key:u.oxford_app_key}};t.default=function(e,t){return r(this,void 0,void 0,(function(){var n,r,u,o,c,l,d,f,p,h,y,v,b,g,w,_,m,S,x,P,q,O,k,I,C,R,M,j,A;return s(this,(function(s){switch(s.label){case 0:if(!e||!e.trim())return[2,t.status(400).send("Invalid word.")];e=e.trim().toLowerCase(),n="https://od-api.oxforddictionaries.com/api/v2/entries/en-gb/"+e+"?fields=definitions%2Cpronunciations",s.label=1;case 1:return s.trys.push([1,3,,4]),[4,i.default(n,a)];case 2:for(r=s.sent(),u=r.data,o={lexicalEntries:[]},c=0,l=u.results||[];c<l.length;c++)for(d=l[c],f=0,p=d.lexicalEntries||[];f<p.length;f++){for(h=p[f],y={entries:[],lexicalCategory:"",pronunciations:[]},o.lexicalEntries.push(y),h.lexicalCategory&&(y.lexicalCategory=h.lexicalCategory.text),v=0,b=h.entries||[];v<b.length;v++)for(g=b[v],w=0,_=g.senses||[];w<_.length;w++){for(m=_[w],S=0,x=m.definitions||[];S<x.length;S++)C=x[S],y.entries.push(C);for(P=0,q=m.subsenses||[];P<q.length;P++)for(O=q[P],k=0,I=O.definitions||[];k<I.length;k++)C=I[k],y.entries.push(C)}for(R=0,M=h.pronunciations||[];R<M.length;R++)j=M[R],y.pronunciations.push({audioFile:j.audioFile,phoneticSpelling:j.phoneticSpelling})}return[2,t.status(200).send(o)];case 3:return A=s.sent(),[2,t.status(400).send(A.message)];case 4:return[2]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(20),i=n(24),u=n(26),a=n(29),o=r.Router();o.use("/products",s.default),o.use("/orders",i.default),o.use("/users",u.default),o.use("/staffs",a.default),t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(21),i=n(23),u=n(7),a=r.Router();a.get("/categories",(function(e,t){s.GetCategories(t)})),a.post("/category",(function(e,t){s.AddCategory(e.body,t)})),a.put("/category",(function(e,t){s.UpdateCategory(e.body,t)})),a.delete("/category",(function(e,t){s.DeleteCategory(e.query,t)})),a.get("/samples",(function(e,t){s.GetSamplesOfCategories(t)})),a.get("",(function(e,t){i.GetProducts(e.query,t)})),a.get("/product",(function(e,t){i.GetProduct(e.query,t)})),a.post("/product",(function(e,t){i.AddProduct(e.body,t)})),a.put("/product",(function(e,t){i.UpdateProduct(e.body,t)})),a.delete("/product",(function(e,t){i.DeleteProduct(e.query,t)})),a.get("/inventory",(function(e,t){u.GetInventory(t)})),a.put("/inventory",(function(e,t){u.AdjustInventory(e.body,t)})),t.default=a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function u(e){try{o(r.next(e))}catch(e){i(e)}}function a(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}o((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,i,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(s=(s=u.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){u.label=i[1];break}if(6===i[0]&&u.label<s[1]){u.label=s[1],s=i;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(i);break}s[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),u=[],a=[],o=[];function c(e,t){if(e.parent_id===t.category_id)return t.children.push({category_id:e.category_id,children:[]}),e.added=!0,!0;for(var n=0;n<t.children.length;n++)if(c(e,t.children[n]))return t.children[n].children.push({category_id:e.category_id,children:[]}),e.added=!0,!0;return!1}t.GetCategories=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:if(u.length)return[2,e.status(200).send(u)];n.label=1;case 1:return n.trys.push([1,3,,4]),"select * from giftsProductsCategories;",[4,i.SqliteAll("select * from giftsProductsCategories;")];case 2:return u=n.sent(),[2,e.status(200).send(u)];case 3:return t=n.sent(),[2,e.status(500).send(t)];case 4:return[2]}}))}))},t.GetSamplesOfCategories=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:if(a.length>0)return[2,e.status(200).send(a)];n.label=1;case 1:return n.trys.push([1,3,,4]),"SELECT * from giftsProducts as g\n              where (\n                select count(*) from giftsProducts as g1\n                where g1.category_id = g.category_id and g1.createdOn >= g.createdOn\n              ) <= 3;",[4,i.SqliteAll("SELECT * from giftsProducts as g\n              where (\n                select count(*) from giftsProducts as g1\n                where g1.category_id = g.category_id and g1.createdOn >= g.createdOn\n              ) <= 3;")];case 2:return a=n.sent(),[2,e.status(200).send(a)];case 3:return t=n.sent(),[2,e.status(500).send(t)];case 4:return[2]}}))}))},t.AddCategory=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o,c;return s(this,(function(s){switch(s.label){case 0:if(!e.name)return[2,t.status(400).send("Invalid name.")];s.label=1;case 1:return s.trys.push([1,3,,4]),n="name",r='"'+e.name+'"',e.details&&(n+=",details",r+=',"'+e.details+'"'),n+=",createdOn",r+=","+Date.now(),o="insert into giftsProductsCategories ("+n+") values ("+r+")",[4,i.SqliteRun(o)];case 2:return s.sent()?(u=[],a=[],[2,t.status(200).send({result:"ok"})]):[2,t.status(200).send({result:"failed"})];case 3:return c=s.sent(),[2,t.status(500).send(c)];case 4:return[2]}}))}))},t.DeleteCategory=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o;return s(this,(function(s){switch(s.label){case 0:if(!e.category_id)return[2,t.status(400).send("Invalid input.")];s.label=1;case 1:return s.trys.push([1,4,,5]),n="select count(*) from giftsProducts where category_id='"+e.category_id+"';",[4,i.SqliteAll(n)];case 2:return(r=s.sent())&&r[0]>0?[2,t.status(403).send({result:"The category is not empty."})]:(n="delete from giftsProductsCategories where category_id='"+e.category_id+"';",[4,i.SqliteRun(n)]);case 3:return s.sent()?(u=[],a=[],[2,t.status(200).send({result:"ok"})]):[2,t.status(500).send({result:"failed"})];case 4:return o=s.sent(),[2,t.status(500).send(o)];case 5:return[2]}}))}))},t.UpdateCategory=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o,c;return s(this,(function(s){switch(s.label){case 0:if(!e.category_id)return[2,t.status(400).send("Invalid category_id.")];if(!e.name)return[2,t.status(400).send("Invalid category name.")];n="set name='"+e.name+"'",e.details&&(n+=",details='"+e.details+"'"),e.parent_id?n+=",parent_id="+e.parent_id:n+=",parent_id=0",s.label=1;case 1:return s.trys.push([1,4,,5]),r="select count(*) cnt from giftsProductsCategories where name='"+e.name+"'",[4,i.SqliteAll(r)];case 2:return(o=s.sent())&&o[0].cnt>0?[2,t.status(400).send({result:"The category name already exists."})]:(r="update giftsProductsCategories "+n+" where category_id="+e.category_id,[4,i.SqliteRun(r)]);case 3:return s.sent()?(u=[],a=[],[2,t.status(200).send({result:"ok"})]):[2,t.status(500).send({result:"failed"})];case 4:return c=s.sent(),[2,t.status(500).send(c)];case 5:return[2]}}))}))},function(){r(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),"select * from giftsProductsCategories;",[4,i.SqliteAll("select * from giftsProductsCategories;")];case 1:for(u=r.sent(),o=[],e=0;e<u.length;e++)u[e].parent_id||(o.push({category_id:u[e].category_id,children:[]}),u[e].added=!0);t=!1;do{t=!1,u.forEach((function(e){e.added||o.forEach((function(n){t=t||c(e,n)}))})),console.log(t)}while(t);return console.log("arranged categories: ",o),[3,3];case 2:return n=r.sent(),console.log(n),[3,3];case 3:return[2]}}))}))}()},function(e,t){e.exports=require("sqlite3")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function u(e){try{o(r.next(e))}catch(e){i(e)}}function a(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}o((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,i,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(s=(s=u.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){u.label=i[1];break}if(6===i[0]&&u.label<s[1]){u.label=s[1],s=i;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(i);break}s[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);t.GetProduct=function(e,t){return r(this,void 0,void 0,(function(){var n,r,u;return s(this,(function(s){switch(s.label){case 0:if(!e.product_id)return[2,t.status(400).send("Invalid product ID.")];s.label=1;case 1:return s.trys.push([1,3,,4]),n="select * from giftsProducts where product_id="+e.product_id+";",[4,i.SqliteGet(n)];case 2:return r=s.sent(),[2,t.status(200).send(r)];case 3:return u=s.sent(),[2,t.status(500).send(u)];case 4:return[2]}}))}))},t.GetProducts=function(e,t){return r(this,void 0,void 0,(function(){var e,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),"select * from giftsProducts where (inactive is null or inactive<>1) limit 50;",[4,i.SqliteAll("select * from giftsProducts where (inactive is null or inactive<>1) limit 50;")];case 1:return e=r.sent(),[2,t.status(200).send(e)];case 2:return n=r.sent(),[2,t.status(500).send(n)];case 3:return[2]}}))}))},t.GetProductsByCategory=function(e,t){return r(this,void 0,void 0,(function(){var n,r,u;return s(this,(function(s){switch(s.label){case 0:if(!e.category_id)return[2,t.status(400).send({result:"Invalid category."})];s.label=1;case 1:return s.trys.push([1,3,,4]),n="select * from giftsProducts where category_id='"+e.category_id+"' limit 50",[4,i.SqliteAll(n)];case 2:return r=s.sent(),[2,t.status(200).send(r)];case 3:return u=s.sent(),[2,t.status(500).send(u)];case 4:return[2]}}))}))},t.AddProduct=function(e,t){return r(this,void 0,void 0,(function(){var n,r,u,a;return s(this,(function(s){switch(s.label){case 0:if(!e.name)return[2,t.status(400).send("Invalid name.")];s.label=1;case 1:return s.trys.push([1,3,,4]),n="name",r='"'+e.name+'"',console.log(typeof e.price),(e.price||0)<=0&&(e.price=0),n+=",price",r+=","+e.price,(e.qty||0)<=0&&(e.qty=0),n+=",qty",r+=","+e.qty,e.colour||(e.colour=""),n+=",colour",r+=',"'+e.colour+'"',e.category_id&&(n+=",category_id",r+=","+e.category_id),e.img||(e.img=""),n+=",img",r+=',"'+e.img+'"',e.packaging||(e.packaging=""),n+=",packaging",r+=',"'+e.packaging+'"',e.note||(e.note=""),n+=",note",r+=',"'+e.note+'"',e.material||(e.material=""),n+=",material",r+=',"'+e.material+'"',e.retailer||(e.retailer=""),n+=",retailer",r+=',"'+e.retailer+'"',n+=",createdOn",r+=","+Date.now(),u="insert into giftsProducts ("+n+") values ("+r+");",[4,i.SqliteRun(u)];case 2:return s.sent()?[2,t.status(200).send({result:"ok"})]:[2,t.status(500).send({result:"failed"})];case 3:return a=s.sent(),console.log(a),[2,t.status(500).send(a)];case 4:return[2]}}))}))},t.UpdateProduct=function(e,t){return r(this,void 0,void 0,(function(){var n,r,u;return s(this,(function(s){switch(s.label){case 0:if(!e.product_id)return[2,t.status(400).send("Invalid product_id.")];s.label=1;case 1:return s.trys.push([1,3,,4]),n="name='"+e.name+"'",e.img&&(n+=",img='"+e.img+"'"),e.price&&(n+=",price="+e.price),e.category_id&&(n+=",category_id="+e.category_id),e.colour&&(n+=",colour='"+e.colour+"'"),e.packaging&&(n+=",packaging='"+e.packaging+"'"),e.material&&(n+=",material='"+e.material+"'"),e.size&&(n+=",size='"+e.size+"'"),e.note&&(n+=",note='"+e.note+"'"),e.retailer&&(n+=",retailer='"+e.retailer+"'"),n+=",modifiedOn="+Date.now(),r="update giftsProducts set "+n+" where product_id="+e.product_id,[4,i.SqliteRun(r)];case 2:return s.sent()?[2,t.status(200).send({result:"ok"})]:[2,t.status(500).send({result:"failed"})];case 3:return u=s.sent(),[2,t.status(500).send(u)];case 4:return[2]}}))}))},t.DeleteProduct=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return s(this,(function(s){switch(s.label){case 0:if(!e.product_id)return[2,t.status(400).send("Invalid product id.")];s.label=1;case 1:return s.trys.push([1,3,,4]),n="update giftsProducts set inactive=1 where product_id="+e.product_id+";",[4,i.SqliteRun(n)];case 2:return s.sent()?[2,t.status(200).send({result:"ok"})]:[2,t.status(500).send({result:"failed"})];case 3:return r=s.sent(),[2,t.status(500).send(r)];case 4:return[2]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(25),i=r.Router();i.get("/userOrders",(function(e,t){if(!e.session||!e.session.user)return t.sendStatus(401);s.GetUserOrders(e.session,t)})),i.get("/staffOrders",(function(e,t){if(!e.session||!e.session.staff)return t.sendStatus(401);s.GetStaffOrders(e.session,t)})),i.post("/order",(function(e,t){s.NewOrder(e,t)})),i.put("/updateStatus",(function(e,t){if(!e.session||!e.session.staff.id)return t.sendStatus(401);if(!e.body.new_status||!e.body.sno||!e.body.order_no)return t.status(400).send("Failed. Pleaes review inputs.");e.body.order_no,e.body.sno,Date.now(),e.session.staff.id,e.body.new_status,e.body.note;return t.status(200).send({result:"ok"})})),i.put("/updateContact",(function(e,t){if(!e.session||!e.session.staff.id)return t.sendStatus(401);if(!e.body.order_no)return t.status(400).send("Order_no empty.");if(!(e.body.email&&e.body.email.includes("@")&&e.body.email.includes("."))||e.body.email.includes("/")||e.body.email.includes("\\"))return t.status(400).send("Invalid email.");if(!e.body.name)return t.status(400).send("Invalid name.");e.body.name,e.body.email,e.body.mobile,e.body.company,e.body.mobile2,e.body.addr,e.body.order_no;return t.status(200).send({result:"ok"})})),i.put("/updateOrderItem",(function(e,t){if(!e.session||!e.session.staff.id)return t.sendStatus(401);if(!e.body.order_no)return t.status(400).send("Failed. Invalid Order No.");if(!e.body.sno||""===e.body.sno)return t.status(400).send("Failed. Invalid Order Sno.");e.body.new_sale_price,e.body.new_qty,e.body.new_status,e.body.order_no,e.body.sno;return t.status(200).send({result:"ok"})})),t.default=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function u(e){try{o(r.next(e))}catch(e){i(e)}}function a(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}o((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,i,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(s=(s=u.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){u.label=i[1];break}if(6===i[0]&&u.label<s[1]){u.label=s[1],s=i;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(i);break}s[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),u=n(8),a=n(7);t.GetUserOrders=function(e,t){return r(this,void 0,void 0,(function(){var n,r,u;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),n="select * from giftsOrders where user_id="+e.user.user_id,[4,i.SqliteAll(n)];case 1:return r=s.sent(),[2,t.status(200).send(r)];case 2:return u=s.sent(),[2,t.status(500).send(u)];case 3:return[2]}}))}))},t.GetStaffOrders=function(e,t){return r(this,void 0,void 0,(function(){var e,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),"select * from giftsOrders",[4,i.SqliteAll("select * from giftsOrders")];case 1:return e=r.sent(),[2,t.status(200).send(e)];case 2:return n=r.sent(),[2,t.status(500).send(n)];case 3:return[2]}}))}))},t.NewOrder=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o,c;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),"order_id,createdOn",n="SG_"+u.randomString(7),r='"'+n+'",'+Date.now(),o="insert into giftsOrders (order_id,createdOn) values ("+r+");",i.SqliteRun(o)?[4,a.ReserveInventory(n,e.body.products)]:[2,t.status(500).send("Error, please retry later.")];case 1:return s.sent()?[2,t.status(200).send("Order successfully.")]:[2,t.status(500).send("Error, failed to reserve inventory.")];case 2:return c=s.sent(),[2,t.status(500).send(c)];case 3:return[2]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(27),i=r.Router();i.post("/login",(function(e,t){s.Login(e,t)})),i.get("/info",(function(e,t){s.UserInfo(e.session,t)})),i.get("/logout",(function(e,t){s.Logout(e,t)})),i.post("/register",(function(e,t){s.Register(e.body,t)})),i.put("/disable",(function(e,t){s.DisableAccount(e.session,t)})),t.default=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function u(e){try{o(r.next(e))}catch(e){i(e)}}function a(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}o((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,i,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(s=(s=u.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){u.label=i[1];break}if(6===i[0]&&u.label<s[1]){u.label=s[1],s=i;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(i);break}s[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),u=n(9);function a(e){if(e){if(e.staff)return!0;if(e.user)return!0}return!1}t.Login=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,o,c,l;return s(this,(function(s){switch(s.label){case 0:if(e.session&&e.session.staff)return[2,t.status(200).send({uid:e.session.staff.uid,bStaff:!0})];if(e.session&&e.session.user)return[2,t.status(200).send({uid:e.session.user.uid})];s.label=1;case 1:return s.trys.push([1,4,,5]),n=(e.body.id||"").trim(),r=u.encrypt(e.body.pwd),a="",n&&r?(a='select * from giftsStaffs \n          where (uid="'+n+'" or email="'+n+'") and pwd="'+r+'" \n          and coalesce(inactive,0) <> 1;',o=e.session,[4,i.SqliteGet(a)]):[2,t.status(400).send({result:"username and password required."})];case 2:return o.staff=s.sent(),e.session.staff?[2,t.status(200).send({uid:e.session.staff.uid,bStaff:!0})]:(a='select * from giftsUsers \n            where (uid="'+n+'" or email="'+n+'") and pwd="'+r+'" \n            and coalesce(inactive,0) <> 1;',c=e.session,[4,i.SqliteGet(a)]);case 3:return c.user=s.sent(),e.session.user?[2,t.status(200).send({uid:e.session.user.uid})]:[2,t.status(403).send("Incorrect username or password")];case 4:return l=s.sent(),console.log(l),[2,t.status(500).send("server error.")];case 5:return[2]}}))}))},t.Logout=function(e,t){return e.session&&e.session.staff&&(e.session.staff=null),e.session&&e.session.user&&(e.session.user=null),t.status(200).send({result:"ok"})},t.Register=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:if(!e.email||!e.pwd)return[2,t.status(400).send("Invalid input.")];r.label=1;case 1:return r.trys.push([1,3,,4]),"email,pwd,createdOn",n='"'+e.email+'","'+u.encrypt(e.pwd)+'",'+Date.now(),[4,i.SqliteRun("insert into giftsUsers (email,pwd,createdOn) values ("+n+")")];case 2:return r.sent()?[2,t.status(200).send({result:"ok"})]:[2,t.status(500).send("Register failed. Please try again later.")];case 3:return r.sent(),[2,t.status(500).send("Register failed. Please try again later.")];case 4:return[2]}}))}))},t.DisableAccount=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(n){if(!e||!e.user)return[2,t.status(403).send("Login is required.")];try{return i.SqliteRun('update giftsUsers set inactive=1 where email="'+e.user.email+'"')?(e.user=null,[2,t.status(200).send({result:"Account disabled."})]):[2,t.status(500).send({text:"Error. Please try again later."})]}catch(e){return[2,t.status(400).send(e)]}return[2]}))}))},t.UserInfo=function(e,t){return a(e)?t.status(200).send({uid:e.staff?e.staff.uid:e.user.uid,email:e.staff?e.staff.email:e.user.email}):t.status(403).send({text:"User not login."})},t.bLogin=a},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(30),i=r.Router();i.post("/admin/newStaff",(function(e,t){s.newStaff(e,t)})),i.put("/admin/disableStaff",(function(e,t){s.disableStaff(e,t)})),i.delete("/admin/deleteStaff",(function(e,t){s.deleteStaff(e,t)})),t.default=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function u(e){try{o(r.next(e))}catch(e){i(e)}}function a(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}o((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,i,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(s=(s=u.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){u.label=i[1];break}if(6===i[0]&&u.label<s[1]){u.label=s[1],s=i;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(i);break}s[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),u=n(9);t.newStaff=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,o;return s(this,(function(s){switch(s.label){case 0:!e.session||e.session.staff,s.label=1;case 1:return s.trys.push([1,3,,4]),e.body.uid?("uid",n='"'+e.body.uid+'"',e.body.pwd?(",pwd",n+=',"'+u.encrypt(e.body.pwd)+'"',e.body.firstName?(",firstname",n+=',"'+e.body.firstName+'"',e.body.lastName?(",lastname",n+=',"'+e.body.lastName+'"',r="insert into giftsStaffs (uid,pwd,firstname,lastname) values ("+n+")",[4,i.SqliteRun(r)]):[2,t.status(400).send({result:"last name is empty."})]):[2,t.status(400).send({result:"first name is empty."})]):[2,t.status(400).send({result:"pwd is empty."})]):[2,t.status(400).send({result:"uid is empty."})];case 2:return!0===(a=s.sent())?[2,t.status(200).send({result:"ok"})]:(t.status(200).send({result:"failed"+a}),[3,4]);case 3:return o=s.sent(),console.log(o),t.status(500).send(o),[3,4];case 4:return[2]}}))}))},t.disableStaff=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return s(this,(function(s){switch(s.label){case 0:if(!e.session||!e.session.staff)return[2,t.status(401).send({result:"Unauthorized."})];s.label=1;case 1:return s.trys.push([1,3,,4]),e.body.staff_id?(n="update giftsStaffs set inactive=1 where staff_id="+e.body.staff_id,[4,i.SqliteRun(n)]):[2,t.status(400).send({result:"staff_id is empty."})];case 2:return!0===s.sent()?[2,t.status(200).send({result:"ok"})]:(t.status(200).send({result:"failed"}),[3,4]);case 3:return r=s.sent(),console.log(r),t.status(500).send(r),[3,4];case 4:return[2]}}))}))},t.deleteStaff=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return s(this,(function(s){switch(s.label){case 0:if(!e.session||!e.session.staff)return[2,t.status(401).send({result:"Unauthorized."})];s.label=1;case 1:return s.trys.push([1,3,,4]),e.query.staff_id?(n="delete from giftsStaffs where staff_id="+e.query.staff_id,[4,i.SqliteRun(n)]):[2,t.status(400).send({result:"staff_id is empty."})];case 2:return!0===s.sent()?[2,t.status(200).send({result:"ok"})]:(t.status(200).send({result:"failed"}),[3,4]);case 3:return r=s.sent(),console.log(r),t.status(500).send(r),[3,4];case 4:return[2]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(32).createTransport({host:"mail.insg.xyz",secure:!0,auth:{user:"i@insg.xyz",pass:"pass1234"}}),s={from:"i@insg.xyz",to:"seesea2@gmail.com",subject:"Hello",text:"This is email from InSG.xyz",html:"<b>this is email from InSG.xyz</b>"};t.default=function(e,t){return r.sendMail(s),t.status(200).send({result:"ok"})}},function(e,t){e.exports=require("nodemailer")}]);
//# sourceMappingURL=server.js.map